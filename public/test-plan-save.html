<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¡åˆ’ä¿å­˜åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            background: #0b3d2e;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #06261c;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-left: 4px solid #0b3d2e;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            border-left-color: #ef4444;
            background: #fee;
        }
        .success {
            border-left-color: #10b981;
            background: #efe;
        }
        h2 {
            color: #0b3d2e;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ è®¡åˆ’ä¿å­˜åŠŸèƒ½è¯Šæ–­å·¥å…·</h1>
    
    <div class="test-section">
        <h2>æ­¥éª¤1ï¼šæµ‹è¯•APIè¿æ¥</h2>
        <p>æ£€æŸ¥APIç«¯ç‚¹æ˜¯å¦å¯è®¿é—®</p>
        <button onclick="testAPIConnection()">æµ‹è¯• /api/plans/create</button>
        <div id="connection-result" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤2ï¼šæµ‹è¯•ç”¨æˆ·è®¤è¯</h2>
        <p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•</p>
        <button onclick="testAuth()">æµ‹è¯•è®¤è¯çŠ¶æ€</button>
        <div id="auth-result" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤3ï¼šæµ‹è¯•ä¿å­˜è®¡åˆ’</h2>
        <p>å°è¯•ä¿å­˜ä¸€ä¸ªæµ‹è¯•è®¡åˆ’</p>
        <button onclick="testSavePlan()">ä¿å­˜æµ‹è¯•è®¡åˆ’</button>
        <div id="save-result" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤4ï¼šæŸ¥çœ‹æ‰€æœ‰è®¡åˆ’</h2>
        <p>è·å–å·²ä¿å­˜çš„è®¡åˆ’åˆ—è¡¨</p>
        <button onclick="testListPlans()">è·å–è®¡åˆ’åˆ—è¡¨</button>
        <div id="list-result" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥éª¤5ï¼šæŸ¥çœ‹æµè§ˆå™¨Console</h2>
        <p>æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾çš„è¯¦ç»†æ—¥å¿—</p>
        <button onclick="window.location.reload()">åˆ·æ–°é¡µé¢</button>
    </div>

    <script>
        function showResult(elementId, message, isError = false) {
            const el = document.getElementById(elementId);
            el.style.display = 'block';
            el.textContent = message;
            el.className = isError ? 'result error' : 'result success';
        }

        async function testAPIConnection() {
            console.log('=== æµ‹è¯•APIè¿æ¥ ===');
            try {
                const response = await fetch('/api/plans/list?status=active&limit=1');
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”OK:', response.ok);
                
                const result = await response.json();
                console.log('å“åº”æ•°æ®:', result);
                
                showResult('connection-result', 
                    `âœ… APIè¿æ¥æˆåŠŸ\nçŠ¶æ€ç : ${response.status}\nå“åº”: ${JSON.stringify(result, null, 2)}`,
                    !response.ok
                );
            } catch (error) {
                console.error('è¿æ¥å¤±è´¥:', error);
                showResult('connection-result', 
                    `âŒ APIè¿æ¥å¤±è´¥\né”™è¯¯: ${error.message}`,
                    true
                );
            }
        }

        async function testAuth() {
            console.log('=== æµ‹è¯•è®¤è¯çŠ¶æ€ ===');
            try {
                const response = await fetch('/api/plans/list?status=active&limit=1');
                const result = await response.json();
                
                if (response.status === 401) {
                    showResult('auth-result', 
                        `âŒ æœªç™»å½•\nè¯·å…ˆç™»å½•ç³»ç»Ÿ`,
                        true
                    );
                } else if (response.ok) {
                    showResult('auth-result', 
                        `âœ… å·²ç™»å½•\nç”¨æˆ·è®¤è¯æˆåŠŸ`,
                        false
                    );
                } else {
                    showResult('auth-result', 
                        `âš ï¸ çŠ¶æ€å¼‚å¸¸\n${JSON.stringify(result, null, 2)}`,
                        true
                    );
                }
            } catch (error) {
                console.error('è®¤è¯æµ‹è¯•å¤±è´¥:', error);
                showResult('auth-result', 
                    `âŒ æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`,
                    true
                );
            }
        }

        async function testSavePlan() {
            console.log('=== æµ‹è¯•ä¿å­˜è®¡åˆ’ ===');
            
            const testPlan = {
                title: 'æµ‹è¯•æ–¹æ¡ˆï¼šæ—©æ™¨è½»è¿åŠ¨',
                content: 'æ¯å¤©æ—©ä¸Šè¿›è¡Œ15åˆ†é’Ÿçš„è½»åº¦è¿åŠ¨ï¼ŒåŒ…æ‹¬æ‹‰ä¼¸å’Œæ…¢èµ°ã€‚',
                difficulty: 'â­â­',
                duration: '1å‘¨'
            };
            
            console.log('æµ‹è¯•è®¡åˆ’æ•°æ®:', testPlan);
            
            try {
                const response = await fetch('/api/plans/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plans: [testPlan],
                        sessionId: 'test-session-' + Date.now()
                    })
                });
                
                console.log('å“åº”çŠ¶æ€:', response.status);
                console.log('å“åº”å¤´:', [...response.headers.entries()]);
                
                const result = await response.json();
                console.log('å“åº”æ•°æ®:', result);
                
                if (response.ok) {
                    showResult('save-result', 
                        `âœ… ä¿å­˜æˆåŠŸï¼\n${JSON.stringify(result, null, 2)}`,
                        false
                    );
                } else {
                    showResult('save-result', 
                        `âŒ ä¿å­˜å¤±è´¥\nçŠ¶æ€ç : ${response.status}\né”™è¯¯: ${JSON.stringify(result, null, 2)}`,
                        true
                    );
                }
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                showResult('save-result', 
                    `âŒ è¯·æ±‚å¤±è´¥\né”™è¯¯ç±»å‹: ${error.constructor.name}\né”™è¯¯æ¶ˆæ¯: ${error.message}\né”™è¯¯å †æ ˆ: ${error.stack}`,
                    true
                );
            }
        }

        async function testListPlans() {
            console.log('=== æµ‹è¯•è·å–è®¡åˆ’åˆ—è¡¨ ===');
            try {
                const response = await fetch('/api/plans/list?status=active&limit=20');
                const result = await response.json();
                
                console.log('è®¡åˆ’åˆ—è¡¨å“åº”:', result);
                
                if (response.ok) {
                    const plans = result.data?.plans || [];
                    showResult('list-result', 
                        `âœ… è·å–æˆåŠŸ\nè®¡åˆ’æ•°é‡: ${plans.length}\n\nè®¡åˆ’åˆ—è¡¨:\n${JSON.stringify(plans, null, 2)}`,
                        false
                    );
                } else {
                    showResult('list-result', 
                        `âŒ è·å–å¤±è´¥\n${JSON.stringify(result, null, 2)}`,
                        true
                    );
                }
            } catch (error) {
                console.error('è·å–å¤±è´¥:', error);
                showResult('list-result', 
                    `âŒ è¯·æ±‚å¤±è´¥\né”™è¯¯: ${error.message}`,
                    true
                );
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ”§ è®¡åˆ’ä¿å­˜è¯Šæ–­å·¥å…·å·²åŠ è½½');
            console.log('æŒ‰é¡ºåºç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•');
        });
    </script>
</body>
</html>
