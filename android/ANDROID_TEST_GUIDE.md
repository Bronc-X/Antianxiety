# 📱 Android 端测试指南

**创建日期**: 2025-12-07  
**项目**: AntiAnxiety  
**目标**: 确保 Android 应用在真机上正常运行

---

## 🎯 测试目标

根据 `LAUNCH_CHECKLIST_DEC25.md`，我们需要验证：
1. ✅ 基础功能（登录、导航、语言切换）
2. ✅ AI 功能（对话、论文搜索、记忆）
3. ✅ 性能指标（首屏加载、AI响应、页面切换）
4. ✅ 兼容性（Android 10+、不同屏幕、深色模式、横竖屏）

---

## 🛠️ 环境准备

### 1. 开发环境

```bash
# 确保已安装依赖
npm install

# 确保 Capacitor 已同步
npm run cap:sync
```

### 2. Android Studio 配置

1. 打开 Android Studio
2. 打开项目：`File > Open > android/`
3. 等待 Gradle 同步完成
4. 确保已安装 Android SDK（API 23+）

### 3. 真机连接

**方法 1: USB 连接**
```bash
# 启用 USB 调试
adb devices

# 端口转发（开发模式）
adb reverse tcp:3000 tcp:3000
```

**方法 2: 无线连接**
```bash
# 连接同一 WiFi
adb connect <设备IP>:5555
```

---

## 📋 测试清单

### ✅ 基础功能测试

#### 1. 登录/注册流程
- [ ] **邮箱注册**
  - 输入邮箱和密码
  - 验证邮箱链接（开发环境跳过）
  - 成功登录后跳转到 `/landing`
- [ ] **邮箱登录**
  - 输入已注册邮箱和密码
  - 成功登录
- [ ] **OAuth 登录**
  - GitHub OAuth（测试）
  - X (Twitter) OAuth（测试）
  - Google OAuth（测试）

#### 2. 页面导航
- [ ] **导航栏功能**
  - 点击"核心洞察" → 跳转到 `/landing`
  - 点击"模型方法" → 跳转到 `/methodology`
  - 点击"权威来源" → 跳转到 `/sources`
  - 点击"分析报告" → 跳转到 `/analysis`
  - 点击"AI计划表" → 跳转到 `/plans`
- [ ] **用户菜单**
  - 点击头像 → 显示菜单
  - "个人设置" → 跳转到 `/settings`
  - "升级订阅" → 跳转到 `/onboarding/upgrade`
  - "退出登录" → 清除会话，跳转到登录页

#### 3. 语言切换
- [ ] **语言切换器**
  - 点击语言切换器
  - 选择"简体中文" → 界面切换为中文
  - 选择"繁體中文" → 界面切换为繁体中文
  - 选择"English" → 界面切换为英文
  - 刷新页面后语言设置保持

---

### ✅ AI 功能测试

#### 1. AI 对话响应
- [ ] **基础对话**
  - 打开 AI 助手页面 (`/assistant`)
  - 发送消息："你好"
  - 验证 AI 回复正常显示
  - 验证流式响应动画正常
- [ ] **上下文记忆**
  - 第一轮：告诉 AI "我最近腿疼"
  - 第二轮：问 "能跑步吗？"
  - 验证 AI 记得腿疼问题，不建议跑步
- [ ] **论文搜索**
  - 问："HRV 和睡眠质量的关系"
  - 验证显示 Semantic Scholar 论文结果
  - 验证论文链接可点击

#### 2. 贝叶斯信念循环
- [ ] **主动仪式**
  - 打开 `/bayesian` 页面
  - 点击"开始重构仪式"
  - 设置恐惧值（滑块）
  - 验证证据雨动画
  - 验证后验概率计算显示
- [ ] **被动微调**
  - 完成一个习惯打卡
  - 验证显示微调 Toast
  - 验证概率修正动画

---

### ✅ 性能指标测试

#### 1. 首屏加载
- [ ] **冷启动**
  - 完全关闭应用
  - 重新打开应用
  - 记录从启动到首屏显示的时间
  - **目标**: < 3秒
- [ ] **热启动**
  - 应用在后台运行
  - 切换回应用
  - 记录恢复时间
  - **目标**: < 1秒

#### 2. AI 响应时间
- [ ] **简单问题**
  - 问："你好"
  - 记录从发送到收到回复的时间
  - **目标**: < 5秒
- [ ] **复杂问题（含论文搜索）**
  - 问："HRV 和睡眠质量的关系，有什么科学依据？"
  - 记录完整响应时间（包括论文搜索）
  - **目标**: < 10秒

#### 3. 页面切换流畅度
- [ ] **导航切换**
  - 快速切换不同页面
  - 验证无卡顿、无白屏
  - 验证动画流畅（60fps）

---

### ✅ 兼容性测试

#### 1. Android 版本
- [ ] **Android 10 (API 29)**
  - 测试基础功能
  - 测试 AI 对话
- [ ] **Android 11 (API 30)**
  - 测试基础功能
  - 测试 AI 对话
- [ ] **Android 12+ (API 31+)**
  - 测试基础功能
  - 测试 AI 对话
  - 测试 Material You 适配

#### 2. 屏幕尺寸
- [ ] **小屏手机** (4.5" - 5.5")
  - 验证文字可读性
  - 验证按钮可点击
  - 验证布局不溢出
- [ ] **标准手机** (5.5" - 6.5")
  - 验证正常显示
- [ ] **大屏手机** (6.5" - 7")
  - 验证布局适配
  - 验证两栏布局正常

#### 3. 深色模式
- [ ] **系统深色模式**
  - 在系统设置中启用深色模式
  - 打开应用
  - 验证深色主题正常显示
  - 验证文字可读性（无白底白字）
  - 验证图表颜色适配
- [ ] **应用内切换**
  - 在设置页面切换主题
  - 验证主题立即生效
  - 验证刷新后保持

#### 4. 横屏/竖屏
- [ ] **竖屏模式**
  - 验证所有页面正常显示
- [ ] **横屏模式**
  - 旋转设备
  - 验证布局适配
  - 验证无内容被裁剪

---

## 🐛 常见问题排查

### 问题 1: 应用无法连接到 localhost:3000

**症状**: 应用显示空白页面或网络错误

**解决方案**:
```bash
# 1. 确保开发服务器运行
npm run dev

# 2. 设置端口转发
adb reverse tcp:3000 tcp:3000

# 3. 验证端口转发
adb reverse --list
```

### 问题 2: 触觉反馈不工作

**症状**: 点击按钮无震动反馈

**检查项**:
- 确保设备支持震动
- 检查 `AndroidManifest.xml` 中是否有 `VIBRATE` 权限
- 检查设备震动设置是否开启

### 问题 3: 网络请求失败

**症状**: API 请求返回错误

**检查项**:
- 检查 `network_security_config.xml` 配置
- 确保生产环境 URL 正确（`capacitor.config.ts`）
- 检查设备网络连接

### 问题 4: 启动画面不显示

**症状**: 启动时直接显示 WebView

**检查项**:
- 检查 `styles.xml` 中 `AppTheme.NoActionBarLaunch` 主题
- 检查 `splash.xml` drawable 是否存在
- 检查 SplashScreen 插件配置

---

## 📊 测试报告模板

```markdown
## 测试日期: YYYY-MM-DD
## 测试设备: [设备型号] (Android [版本])
## 测试人员: [姓名]

### 基础功能
- [x] 登录/注册: ✅ 通过
- [x] 页面导航: ✅ 通过
- [x] 语言切换: ✅ 通过

### AI 功能
- [x] AI 对话响应: ✅ 通过
- [x] 论文搜索: ✅ 通过
- [x] 上下文记忆: ✅ 通过

### 性能指标
- [x] 首屏加载: 2.5秒 ✅
- [x] AI 响应: 4.8秒 ✅
- [x] 页面切换: 流畅 ✅

### 兼容性
- [x] Android 版本: ✅ 通过
- [x] 屏幕尺寸: ✅ 通过
- [x] 深色模式: ✅ 通过
- [x] 横竖屏: ✅ 通过

### 发现的问题
1. [问题描述]
   - 严重程度: [高/中/低]
   - 复现步骤: [步骤]
   - 预期行为: [预期]
   - 实际行为: [实际]

### 总体评价
[总体评价和建议]
```

---

## 🚀 下一步行动

1. ✅ 完成基础功能测试
2. ✅ 完成 AI 功能测试
3. ✅ 完成性能测试
4. ✅ 完成兼容性测试
5. ✅ 修复发现的问题
6. ✅ 准备发布 APK

---

**最后更新**: 2025-12-07

