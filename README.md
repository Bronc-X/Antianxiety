# 🌿 NomorAnxious - 智能健康管理平台

> **30+ 精英人士的专业健康训练系统** - 用科学数据对抗代谢退行，用理性思考摆脱焦虑。

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Next.js](https://img.shields.io/badge/Next.js-15-black)](https://nextjs.org/)
[![Supabase](https://img.shields.io/badge/Supabase-Powered-green)](https://supabase.com/)
[![AI](https://img.shields.io/badge/AI-Claude%20%26%20DeepSeek-blue)](https://www.anthropic.com/)

---

## 🎯 项目愿景

### 核心理念
**为 30+ 精英人群提供基于第一性原理的健康管理系统**，通过智能状态感知、数据驱动分析和个性化训练方案，帮助用户科学应对代谢退行，摆脱被贩卖的焦虑。

### 我们相信
- 🧬 **真相优于安慰** - 准确的生理数据比虚假的心灵鸡汤更有价值
- 🎯 **专注胜过贪多** - 每天一个核心任务，避免执行焦虑
- 📊 **趋势重于瞬间** - 长期数据积累揭示真实健康状态
- 🤖 **AI 辅助决策** - 人工智能提供专业建议，人类做最终选择

### 目标用户
**30-45 岁追求品质的精英人群**
- 💼 科技从业者、创业者、高管
- 🌍 海外中产、硅谷科技圈
- 📈 对数据准确度要求高
- 🎯 追求高效、科学的健康管理方式

---

## ✨ 核心功能

### 🧠 1. 智能状态感知系统
**基于生理数据的实时健康评估**
- ✅ **能量电池可视化** - 直观显示当前身体状态（高效能/平衡/恢复模式）
- ✅ **智能休息许可** - 检测到高负荷时允许暂停打卡，科学休息
- ✅ **个性化洞察** - 基于睡眠、HRV、压力等多维数据综合分析
- 📊 数据来源：每日健康日志（睡眠时长、运动量、压力水平、HRV等）

### 🎯 2. 唯一核心任务（The One Thing）
**每天专注一件最重要的事**
- ✅ **动态任务推荐** - AI 根据身体状态和健康目标智能推荐
- ✅ **最小阻力设计** - 任务设计符合当前能量水平
- ✅ **即时交互反馈** - 点击完成，获得即时鼓励
- ✅ **额外习惯系统** - 完成核心任务后可选择进阶习惯
- 🎨 设计理念：避免任务列表焦虑，专注当下最重要的行动

### 📈 3. 长期趋势分析
**数据积累揭示真实健康状态**
- ✅ **3天数据门槛** - 积累3天数据后自动生成趋势分析
- ✅ **多维度洞察** - 睡眠质量、运动量、压力水平、心情变化
- ✅ **趋势可视化** - 直观图表展示健康改善方向
- ✅ **智能建议** - 基于趋势数据提供针对性建议
- 📊 分析维度：睡眠趋势、运动模式、压力管理、整体健康评分

### 💡 4. 动态健康贴士
**个性化专业健康知识推送**
- ✅ **智能匹配算法** - 基于睡眠质量、运动量、压力状态推荐
- ✅ **15+ 专业贴士库** - 覆盖睡眠、运动、营养、压力、长寿等领域
- ✅ **自动轮播系统** - 8秒自动切换，保持新鲜感
- ✅ **去AI化表达** - 使用训练、调节、重建等体感词汇，避免科技术语
- 🎯 设计原则：降低理解门槛，突出实用性和可操作性

### 🤖 5. AI 健康助手
**24/7 专业健康咨询**
- ✅ **双模型架构** - Claude + DeepSeek，确保响应质量
- ✅ **记忆系统** - 记住用户偏好和历史对话
- ✅ **上下文感知** - 自动加载50条历史对话
- ✅ **方案生成** - AI自动生成个性化健康方案
- ✅ **确认保存机制** - 用户确认后同步到计划表
- 🔄 闭环系统：AI生成 → 用户确认 → 执行记录 → AI优化

### 📋 6. 健康计划管理
**系统化健康目标追踪**
- ✅ **iOS日程表风格** - 熟悉的交互体验
- ✅ **计划展开/折叠** - 查看完整方案详情
- ✅ **执行记录** - 每日完成情况追踪
- ✅ **计划删除** - 灵活管理健康方案
- 📊 数据流：用户执行数据 → AI学习 → 优化下一个方案

### 📚 7. 个性化内容推荐
**高质量健康信息RAG系统**
- ✅ **多源抓取** - Reddit、PubMed、X.com 精选内容
- ✅ **向量检索** - 基于用户画像智能匹配
- ✅ **质量过滤** - 4.5+ 相关性评分门槛
- ✅ **独立推荐页** - `/feed` 个性化内容流
- ✅ **灵感板块** - `/inspiration` 专业推文展示
- 🎯 目标：高置信度信息推送，避免信息噪音

### ⚙️ 8. 用户系统
**完善的账号与设置体系**
- ✅ **邮箱/密码认证** - 完整注册登录流程
- ✅ **第三方登录** - Google、X (Twitter)、GitHub OAuth
- ✅ **头像上传** - 2MB限制，实时预览
- ✅ **社交平台绑定** - 6大平台集成
- ✅ **多语言支持** - 中英文切换
- ✅ **会员系统** - Pro升级功能

---

## 🚀 快速开始

### 环境要求
- Node.js 18+
- npm 或 pnpm
- Supabase 账号
- Claude API Key（可选：DeepSeek API Key）

### 本地开发

```bash
# 1. 克隆仓库
git clone https://github.com/Bronc-X/Nomoreanxiousweb.git
cd Nomoreanxiousweb

# 2. 安装依赖
npm install

# 3. 配置环境变量
cp .env.example .env.local
# 编辑 .env.local 填入你的 API Keys

# 4. 启动开发服务器
npm run dev

# 5. 访问应用
# http://localhost:3000
```

### 环境变量配置

在 `.env.local` 文件中配置以下变量：

```bash
# Supabase
NEXT_PUBLIC_SUPABASE_URL=你的Supabase项目URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=你的Supabase匿名密钥

# AI服务
ANTHROPIC_API_KEY=你的Claude API Key
DEEPSEEK_API_KEY=你的DeepSeek API Key（可选）

# OAuth（可选）
GITHUB_CLIENT_ID=你的GitHub OAuth Client ID
GITHUB_CLIENT_SECRET=你的GitHub OAuth Client Secret
```

⚠️ **安全提示**：不要将 `.env.local` 提交到 Git！所有 API Keys 必须通过环境变量配置。

### 数据库设置

1. 在 Supabase 控制台创建新项目
2. 执行 SQL 脚本初始化数据库：
   - `supabase_init_complete.sql` - 基础表结构
   - `supabase_ai_memory_vector.sql` - AI 记忆系统
   - `supabase_content_feed_vectors.sql` - 内容推荐系统
   - 其他 SQL 文件根据需要执行

3. 启用 Realtime（在 Supabase 控制台）：
   - `habits`, `habit_completions`, `ai_reminders` 表

---

## 📁 项目结构

```
├── app/                    # Next.js 15 App Router
│   ├── landing/           # 主页（智能状态感知）
│   ├── assistant/         # AI 助手
│   ├── plans/             # 健康计划管理
│   ├── feed/              # 个性化内容推荐
│   ├── analysis/          # AI 分析报告
│   ├── settings/          # 用户设置
│   └── api/               # API 路由
├── components/             # React 组件
│   ├── LandingContent.tsx # 主页核心组件
│   ├── DynamicHealthTips.tsx # 健康贴士
│   └── ...
├── lib/                   # 工具库
│   ├── health-logic.ts    # 健康状态分析逻辑
│   ├── trend-analysis.ts  # 趋势分析算法
│   ├── supabase.ts        # Supabase 客户端
│   └── ...
├── types/                 # TypeScript 类型定义
└── supabase/              # Supabase SQL 脚本
```

---

## 🔗 链接

**这是项目的灵魂特性，基于生理数据的实时健康评估。**

### 运作原理

1. **数据采集** → 每日健康日志（睡眠、HRV、压力、运动）
2. **智能分析** → `health-logic.ts` 综合评估身体状态
3. **模式识别** → 高效能 / 平衡 / 恢复模式
4. **动态推荐** → 基于状态匹配最合适的任务
5. **反馈优化** → 执行数据反哺算法持续改进

路由: Expo Router (使用基于文件的路由，Cursor AI 对此非常熟悉)。

职责:

认证: 使用 supabase-js SDK 处理用户登录、注册 (Google/X/微信等)。

输入: 提供表单让用户提交“习惯打卡”、“情绪日志”等原始数据。

展示: 实时订阅 (Supabase Realtime) 或查询“状态大脑”计算出的“真相”（例如：“贝叶斯曲线”图表）。

交互: 将用户的聊天消息发送到“逻辑层”(Vercel)。

关键规则: 前端禁止计算任何业务逻辑。 (例如：前端不应该知道“贝叶斯函数”的公式)。

B. 逻辑/计算层 (AI Agent): Vercel Functions
技术: Vercel Serverless Functions (Node.js)。

SDK: Vercel AI SDK 或 LangChain.js (用于 AI 编排)。

职责: 这是 AI 助手“思考”的地方。

AI 对话 API (/api/chat):

接收 App 传来的用户消息。

调用 Supabase pgvector 检索用户的“历史记忆”。

构建“冷峻”的 Prompt (包含历史记忆)。

调用 OpenAI API。

将 Q&A 存回 pgvector (完成记忆闭环)。

返回 AI 回应。

个性化信息流 API (/api/feed):

接收 App 请求。

从 Supabase pgvector 获取用户画像。

在“内容池”向量表中执行 RAG 搜索 (e.g., "相关性 > 4.5/5")。

返回高度过滤的信息。

后台任务触发器 (/api/ingest-content):

由 pg_cron 定时触发。

爬取 X/Reddit/期刊，将其嵌入并存入“内容池”向量表。

C. 状态大脑 (State Brain): Supabase
技术: Supabase (PostgreSQL)。

职责: 存储一切“真相”，并执行“第一性原理”的计算。

认证 (Auth): 管理所有用户（邮箱、Google、X、微信）。

AI 记忆 (pgvector):

表: ai_memory (user_id, embedding, content_text, created_at)。

职责: 存储每一次与用户的有意义互动，实现“永不SAY HI”。

贝叶斯逻辑 (PostgreSQL Functions):

这是你的核心创新点。

你将使用 pl/pgsql (SQL 的一种编程语言) 在数据库内部直接编写你的“贝叶斯函数”和“信心增强函数”。

触发器: 当一个新“习惯打卡”被存入 habit_completions 表时，一个数据库触发器 (Trigger) 会自动调用这些函数。

输出: 函数的计算结果（例如：belief_score: 0.85）被写入一个“真相表”(e.g., user_metrics)。

好处: 这 100% 符合“冷峻”和“第一性原理”。计算在离数据最近的地方发生，结果绝对可靠，前端只是在读取结果。

自动化 (pg_cron):

一个内置的定时任务调度器。

职责: “预测用户行为”和“前瞻性建议”。

示例: 设置一个 Cron 任务 ('0 22 * * *') (每晚 10 点) 运行一个函数，该函数分析用户当天的 habit_completions，如果发现“最小阻力习惯”未完成，它可以主动调用 Vercel Function 向用户推送一个“冷峻”的提醒。

3. 核心数据模型 (Core Data Schema)
以下是支持此架构所需的核心数据表 (在 Supabase 中)：

profiles (用户表):

id (关联 auth.users)

full_name, avatar_url, language (e.g., 'en', 'zh')

user_persona_embedding (Vector): 由 AI 生成的、总结用户核心画像的向量（用于 RAG）。

habits (习惯定义表):

id, user_id, title, description (e.g., "10分钟冥想")

min_resistance_level (最小阻力等级 1-5)

habit_completions (习惯打卡表):

id, habit_id, user_id, completed_at

user_notes (可选)

user_metrics (真相/指标表):

user_id, date

belief_curve_score (float): 由贝叶斯函数计算并写入

confidence_score (float): 由信心函数计算并写入

physical_performance_score (float)

(前端 App 只会读取这张表来画图)

ai_memory (AI 记忆表 - 向量表):

id, user_id

content_text (Q 或 A 的文本)

embedding (Vector): content_text 的向量

created_at

content_feed_vectors (RAG 内容池 - 向量表):

id, source_url (e.g., Reddit/X 链接)

content_text (帖子/论文摘要)

embedding (Vector): content_text 的向量

created_at

relevance_score (0-5)

published_at, crawled_at, updated_at

---

---

## ⚠️ 核心功能：AI方案闭环系统

**这是项目的灵魂，从AI生成方案到用户执行再到数据反馈的完整闭环。**

详见：**[AI_PLAN_CLOSED_LOOP_SYSTEM.md](./AI_PLAN_CLOSED_LOOP_SYSTEM.md)**

### 核心流程
1. AI助理生成方案（2个方案：基础+进阶）
2. 用户交互：[修改] [确认] 按钮
3. 确认后同步到主页计划表（iOS日程表风格）
4. 每日记录执行情况
5. AI采集数据优化下一个方案

### 为什么重要
- ✅ AI生成个性化方案
- ✅ 记录真实执行数据
- ✅ AI学习用户偏好
- ✅ 闭环优化，越用越准确

**必须优先实现此功能。**

---

## 🎉 最新完成（2025-11-23）
1. **✅ 登录重定向循环修复** - 禁用middleware冲突，统一跳转到/landing
2. **✅ 导航栏完善** - 恢复5个主要链接（核心洞察、模型方法、权威来源、分析报告、AI计划表）
3. **✅ 用户菜单恢复** - UserProfileMenu（个人设置、升级订阅、退出登录）
4. **✅ 计划删除功能** - 修复API动态路由params为Promise的问题
5. **✅ 项目大清理** - 删陂89个文件（-34%），代码从260个减至171个文件
6. **✅ 页面功能优化** - 新增/feed个性化推荐页面，明确页面功能划分
7. **✅ AI方案闭环系统** - 完整实现从生成到执行的闭环

## 当前重点 TODO
1. **✅ 已完成：AI方案闭环系统** - 完整闭环已打通 ✨
2. **✅ 已完成：Web端迁移到新表结构** - habits/habit_completions表已激活
3. **✅ 已完成：页面架构优化** - landing/assistant/plans/feed/inspiration功能明确
4. **✅ 已完成：用户体验优化** - 登录流程、导航栏、用户菜单全部修复
5. 🔴 完善README - 添加截图、架构图、快速开始指南
6. 🔴 Vercel部署 - 配置环境变量，上线Demo
7. 配置 pg_cron 定时任务，启用AI预测性提醒
8. iOS ↔ Web 数据同步策略确认
9. Onboarding 过程添加信念问卷 & 先验值校准
10. 编写技术博客，准备Product Hunt发布
