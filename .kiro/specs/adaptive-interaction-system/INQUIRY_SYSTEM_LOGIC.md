# é—®è¯¢ç³»ç»Ÿå®Œæ•´é€»è¾‘è¯´æ˜
# Inquiry System Complete Logic Documentation

## æ–‡æ¡£ç›®çš„ | Document Purpose

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é—®è¯¢ç³»ç»Ÿï¼ˆInquiry Systemï¼‰çš„å®Œæ•´å·¥ä½œé€»è¾‘ï¼ŒåŒ…æ‹¬ï¼š
1. é—®é¢˜ç”Ÿæˆæœºåˆ¶ï¼ˆæ™ºèƒ½æ•°æ®ç¼ºå£æ£€æµ‹ï¼‰
2. æ•°æ®åŒæ­¥æµç¨‹ï¼ˆé—­ç¯è¿æ¥ï¼‰
3. AIå¯¹è¯é›†æˆï¼ˆè®°å¿†ç³»ç»Ÿï¼‰
4. å†…å®¹æ¨èå½±å“ï¼ˆè‡ªé€‚åº”æ¨èï¼‰
5. ç•Œé¢äº¤äº’è®¾è®¡

This document provides a comprehensive explanation of the Inquiry System's complete logic, including:
1. Question generation mechanism (intelligent data gap detection)
2. Data synchronization flow (closed-loop connection)
3. AI conversation integration (memory system)
4. Content recommendation impact (adaptive recommendations)
5. UI interaction design

---

## 1. é—®é¢˜ç”Ÿæˆé€»è¾‘ | Question Generation Logic

### 1.1 æ ¸å¿ƒåŸç† | Core Principle

**é—®é¢˜ä¸æ˜¯é¢„è®¾çš„ï¼Œè€Œæ˜¯åŸºäºæ•°æ®ç¼ºå£ï¼ˆData Gapsï¼‰æ™ºèƒ½ç”Ÿæˆçš„ã€‚**

Questions are NOT pre-defined but intelligently generated based on data gaps.

### 1.2 å…­ä¸ªæ•°æ®ç»´åº¦ | Six Data Dimensions

ç³»ç»Ÿç›‘æµ‹ç”¨æˆ·åœ¨ä»¥ä¸‹6ä¸ªå¥åº·ç»´åº¦çš„æ•°æ®å®Œæ•´æ€§ï¼š

| ç»´åº¦ | å­—æ®µå | ä¼˜å…ˆçº§ | æè¿° |
|------|--------|--------|------|
| ç¡çœ æ—¶é•¿ | `sleep_hours` | é«˜ | æ˜¨æ™šç¡çœ å°æ—¶æ•° |
| å‹åŠ›æ°´å¹³ | `stress_level` | é«˜ | å½“å‰å‹åŠ›æ„Ÿå—ï¼ˆ1-10ï¼‰ |
| è¿åŠ¨æ—¶é•¿ | `exercise_duration` | ä¸­ | ä»Šæ—¥è¿åŠ¨åˆ†é’Ÿæ•° |
| é¥®é£Ÿè´¨é‡ | `meal_quality` | ä¸­ | ä»Šæ—¥é¥®é£Ÿå¥åº·ç¨‹åº¦ |
| æƒ…ç»ªçŠ¶æ€ | `mood` | ä½ | å½“å‰å¿ƒæƒ…çŠ¶æ€ |
| é¥®æ°´é‡ | `water_intake` | ä½ | ä»Šæ—¥é¥®æ°´é‡ |


### 1.3 æ•°æ®ç¼ºå£æ£€æµ‹ç®—æ³• | Data Gap Detection Algorithm

**ä»£ç ä½ç½®**: `lib/inquiry-engine.ts` â†’ `identifyDataGaps()`

```typescript
function identifyDataGaps(
  recentData: Record<string, { value: string; timestamp: string }>,
  staleThresholdHours: number = 24
): DataGap[]
```

**æ£€æµ‹è§„åˆ™**:
1. å¦‚æœæŸä¸ªç»´åº¦**å®Œå…¨æ²¡æœ‰æ•°æ®** â†’ æ ‡è®°ä¸ºç¼ºå£
2. å¦‚æœæŸä¸ªç»´åº¦çš„æ•°æ®**è¶…è¿‡24å°æ—¶æœªæ›´æ–°** â†’ æ ‡è®°ä¸ºç¼ºå£
3. æŒ‰ä¼˜å…ˆçº§æ’åºï¼šé«˜ > ä¸­ > ä½
4. é€‰æ‹©**æœ€é«˜ä¼˜å…ˆçº§**çš„ç¼ºå£ç”Ÿæˆé—®é¢˜

**ç¤ºä¾‹åœºæ™¯**:
- ç”¨æˆ·æ˜¨å¤©æ²¡æœ‰è®°å½•ç¡çœ  â†’ ç”Ÿæˆ"æ˜¨æ™šç¡å¾—æ€ä¹ˆæ ·ï¼Ÿ"
- ç¡çœ æ•°æ®å·²æœ‰ï¼Œä½†å‹åŠ›æ•°æ®ç¼ºå¤± â†’ ç”Ÿæˆ"ä»Šå¤©æ„Ÿè§‰å‹åŠ›å¤§å—ï¼Ÿ"
- æ‰€æœ‰é«˜ä¼˜å…ˆçº§æ•°æ®éƒ½æœ‰ â†’ è¯¢é—®ä¸­ä¼˜å…ˆçº§ï¼ˆè¿åŠ¨ã€é¥®é£Ÿï¼‰

### 1.4 é—®é¢˜æ¨¡æ¿ç³»ç»Ÿ | Question Template System

**ä»£ç ä½ç½®**: `lib/inquiry-engine.ts` â†’ `INQUIRY_TEMPLATES`

æ¯ä¸ªæ•°æ®ç»´åº¦éƒ½æœ‰**ä¸­è‹±æ–‡åŒè¯­æ¨¡æ¿**ï¼š

```typescript
const INQUIRY_TEMPLATES: Record<string, Record<'zh' | 'en', InquiryQuestion>> = {
  sleep_hours: {
    zh: {
      question_text: 'æ˜¨æ™šç¡å¾—æ€ä¹ˆæ ·ï¼Ÿå¤§æ¦‚ç¡äº†å‡ ä¸ªå°æ—¶ï¼Ÿ',
      options: [
        { label: 'ä¸åˆ°6å°æ—¶', value: 'under_6' },
        { label: '6-7å°æ—¶', value: '6_7' },
        { label: '7-8å°æ—¶', value: '7_8' },
        { label: '8å°æ—¶ä»¥ä¸Š', value: 'over_8' }
      ]
    },
    en: {
      question_text: 'How did you sleep last night? About how many hours?',
      options: [
        { label: 'Less than 6 hours', value: 'under_6' },
        { label: '6-7 hours', value: '6_7' },
        { label: '7-8 hours', value: '7_8' },
        { label: 'More than 8 hours', value: 'over_8' }
      ]
    }
  }
  // ... å…¶ä»–5ä¸ªç»´åº¦çš„æ¨¡æ¿
}
```


### 1.5 è¯­è¨€åŒæ­¥æœºåˆ¶ | Language Synchronization

**å…³é”®ç‰¹æ€§**: é—®é¢˜æ–‡æœ¬ä¼šæ ¹æ®ç”¨æˆ·å½“å‰è¯­è¨€è®¾ç½®**å®æ—¶åˆ‡æ¢**

**å®ç°ä½ç½®**:
- **å‰ç«¯**: `components/ActiveInquiryBanner.tsx` â†’ ä¼ é€’ `language` å‚æ•°
- **API**: `app/api/inquiry/pending/route.ts` â†’ æ¥æ”¶ `language` å‚æ•°
- **å¼•æ“**: `lib/inquiry-engine.ts` â†’ `generateInquiryQuestion(gaps, goals, language)`

**æµç¨‹**:
```
ç”¨æˆ·åˆ‡æ¢è¯­è¨€ï¼ˆä¸­æ–‡ â†” è‹±æ–‡ï¼‰
    â†“
Banner ç»„ä»¶æ£€æµ‹åˆ°è¯­è¨€å˜åŒ–
    â†“
é‡æ–°è°ƒç”¨ API: GET /api/inquiry/pending?language=en
    â†“
API ä½¿ç”¨æ–°è¯­è¨€é‡æ–°ç”Ÿæˆé—®é¢˜æ–‡æœ¬
    â†“
è¿”å›è‹±æ–‡é—®é¢˜å’Œé€‰é¡¹
    â†“
Banner æ˜¾ç¤ºè‹±æ–‡å†…å®¹
```

---

## 2. æ•°æ®åŒæ­¥æµç¨‹ | Data Synchronization Flow

### 2.1 å®Œæ•´æ•°æ®æµå›¾ | Complete Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·åœ¨ Banner ä¸­çœ‹åˆ°é—®é¢˜å¹¶ç‚¹å‡»é€‰é¡¹å›ç­”                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/inquiry/respond                                   â”‚
â”‚  Body: { inquiryId, response }                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤1: æ›´æ–° inquiry_history è¡¨                              â”‚
â”‚  - è®°å½• user_response                                        â”‚
â”‚  - è®°å½• responded_at æ—¶é—´æˆ³                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤2: åŒæ­¥åˆ° daily_calibrations è¡¨                         â”‚
â”‚  - å°†å›ç­”å€¼æ˜ å°„ä¸ºç»“æ„åŒ–æ•°æ®                                   â”‚
â”‚  - ä¾‹å¦‚: "under_6" â†’ sleep_hours: 5                         â”‚
â”‚  - ä¾‹å¦‚: "high" â†’ stress_level: 9                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ­¥éª¤3: æ›´æ–° user_activity_patterns è¡¨                       â”‚
â”‚  - è®°å½•ç”¨æˆ·æ´»è·ƒæ—¶é—´ï¼ˆæ˜ŸæœŸå‡ ã€å‡ ç‚¹ï¼‰                           â”‚
â”‚  - ç”¨äºä¼˜åŒ–æœªæ¥é—®è¯¢æ—¶æœº                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›æˆåŠŸå“åº”                                                 â”‚
â”‚  { success: true, message: "æ„Ÿè°¢ä½ çš„å›ç­”ï¼" }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 2.2 å›ç­”å€¼æ˜ å°„è¡¨ | Response Value Mapping

**ä»£ç ä½ç½®**: `app/api/inquiry/respond/route.ts`

| æ•°æ®ç»´åº¦ | ç”¨æˆ·å›ç­” | æ˜ å°„å€¼ | æ•°æ®ç±»å‹ |
|---------|---------|--------|---------|
| **ç¡çœ æ—¶é•¿** | `under_6` | `5` | number (å°æ—¶) |
| | `6_7` | `6.5` | number |
| | `7_8` | `7.5` | number |
| | `over_8` | `8.5` | number |
| **å‹åŠ›æ°´å¹³** | `low` | `3` | number (1-10é‡è¡¨) |
| | `medium` | `6` | number |
| | `high` | `9` | number |
| **è¿åŠ¨æ—¶é•¿** | `none` | `0` | number (åˆ†é’Ÿ) |
| | `light` | `15` | number |
| | `moderate` | `30` | number |
| | `intense` | `60` | number |
| **æƒ…ç»ªçŠ¶æ€** | `bad` | `3` | number (1-10é‡è¡¨) |
| | `okay` | `6` | number |
| | `great` | `9` | number |
| **é¥®é£Ÿè´¨é‡** | `healthy` | `healthy` | string |
| | `average` | `average` | string |
| | `unhealthy` | `unhealthy` | string |
| **é¥®æ°´é‡** | `low` | `low` | string |
| | `moderate` | `moderate` | string |
| | `high` | `high` | string |

**å…³é”®ä»£ç ç‰‡æ®µ**:
```typescript
switch (gapField) {
  case 'sleep_hours':
    const sleepMap: Record<string, number> = {
      'under_6': 5,
      '6_7': 6.5,
      '7_8': 7.5,
      'over_8': 8.5,
    };
    calibrationUpdate.sleep_hours = sleepMap[response] || null;
    break;
  
  case 'stress_level':
    const stressMap: Record<string, number> = {
      'low': 3,
      'medium': 6,
      'high': 9,
    };
    calibrationUpdate.stress_level = stressMap[response] || null;
    break;
  
  // ... å…¶ä»–ç»´åº¦
}

// Upsert åˆ° daily_calibrations
await supabase
  .from('daily_calibrations')
  .upsert({
    user_id: user.id,
    date: today,
    ...calibrationUpdate,
    updated_at: new Date().toISOString(),
  }, {
    onConflict: 'user_id,date',
  });
```


---

## 3. AIå¯¹è¯é›†æˆ | AI Conversation Integration

### 3.1 é—®è¯¢ä¸Šä¸‹æ–‡æå– | Inquiry Context Extraction

**ä»£ç ä½ç½®**: `lib/inquiry-context.ts`

**æ ¸å¿ƒå‡½æ•°**: `getInquiryContext(userId: string)`

**åŠŸèƒ½**: ä»æœ€è¿‘7å¤©çš„é—®è¯¢å†å²ä¸­æå–ç”¨æˆ·å¥åº·æ´å¯Ÿ

**è¿”å›æ•°æ®ç»“æ„**:
```typescript
interface InquiryContextSummary {
  insights: {
    recentSleepPattern: 'poor' | 'average' | 'good' | null;
    recentStressLevel: 'low' | 'medium' | 'high' | null;
    recentExercise: 'none' | 'light' | 'moderate' | 'intense' | null;
    recentMood: 'bad' | 'okay' | 'great' | null;
    lastInquiryTime: string | null;
    totalResponses: number;
    responseRate: number; // 0-1
  };
  recentResponses: Array<{
    question: string;
    response: string;
    timestamp: string;
    dataGap: string;
  }>;
  suggestedTopics: string[]; // åŸºäºå›ç­”æ¨èçš„è¯é¢˜
}
```

**æ´å¯Ÿæå–é€»è¾‘**:
```typescript
// ç¤ºä¾‹ï¼šç¡çœ æ¨¡å¼åˆ†æ
if (inquiry.user_response === 'under_6') {
  insights.recentSleepPattern = 'poor';
  suggestedTopics.push('sleep_optimization', 'circadian_rhythm');
}

// ç¤ºä¾‹ï¼šå‹åŠ›æ°´å¹³åˆ†æ
if (inquiry.user_response === 'high') {
  insights.recentStressLevel = 'high';
  suggestedTopics.push('stress_management', 'cortisol_regulation', 'breathing_exercises');
}
```

### 3.2 è‡ªç„¶è¯­è¨€æ‘˜è¦ç”Ÿæˆ | Natural Language Summary Generation

**æ ¸å¿ƒå‡½æ•°**: `generateInquirySummary(context, language)`

**ä¸­æ–‡æ‘˜è¦ç¤ºä¾‹**:
```
ç”¨æˆ·æœ€è¿‘çš„çŠ¶æ€ï¼š
- ç¡çœ ï¼šç¡çœ ä¸è¶³ï¼ˆå°‘äº6å°æ—¶ï¼‰
- å‹åŠ›ï¼šå‹åŠ›è¾ƒå¤§
- è¿åŠ¨ï¼šæœªè¿åŠ¨
- æƒ…ç»ªï¼šå¿ƒæƒ…ä¸ä½³

å“åº”ç‡ï¼š80%
```

**è‹±æ–‡æ‘˜è¦ç¤ºä¾‹**:
```
User's recent status:
- Sleep: Poor sleep (less than 6 hours)
- Stress: High stress
- Exercise: No exercise
- Mood: Bad mood

Response rate: 80%
```


### 3.3 æ³¨å…¥åˆ°AIç³»ç»Ÿæç¤º | Injection into AI System Prompt

**ä»£ç ä½ç½®**: `app/api/chat/route.ts`

**é›†æˆæµç¨‹**:
```typescript
// 1. è·å–é—®è¯¢ä¸Šä¸‹æ–‡
let inquirySummary: string | null = null;
try {
  const inquiryContext = await getInquiryContext(userId);
  inquirySummary = generateInquirySummary(inquiryContext, 'zh');
  console.log('ğŸ“‹ Inquiry ä¸Šä¸‹æ–‡å·²åŠ è½½:', inquirySummary);
} catch (error) {
  console.warn('âš ï¸ è·å– Inquiry ä¸Šä¸‹æ–‡å¤±è´¥:', error);
}

// 2. æ„å»ºç”¨æˆ·ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«é—®è¯¢æ‘˜è¦ï¼‰
userContext = buildUserContext(
  userProfile, 
  todayBioData, 
  recentBioData, 
  questionnaireData, 
  activePlan, 
  inquirySummary  // â† é—®è¯¢æ‘˜è¦æ³¨å…¥
);

// 3. ç³»ç»Ÿæç¤ºä¸­åŒ…å«é—®è¯¢æ´å¯Ÿ
const systemPrompt = `
You are MAX, an Anti-Anxiety Cognitive Prosthetic.

${userContext}  // â† åŒ…å« [ACTIVE INQUIRY INSIGHTS] éƒ¨åˆ†

${memoryContext}

...
`;
```

**ç³»ç»Ÿæç¤ºä¸­çš„é—®è¯¢éƒ¨åˆ†**:
```
[ACTIVE INQUIRY INSIGHTS - ä¸»åŠ¨è¯¢é—®æ´å¯Ÿ]
ç”¨æˆ·æœ€è¿‘çš„çŠ¶æ€ï¼š
- ç¡çœ ï¼šç¡çœ ä¸è¶³ï¼ˆå°‘äº6å°æ—¶ï¼‰
- å‹åŠ›ï¼šå‹åŠ›è¾ƒå¤§

âš ï¸ AI æŒ‡å¯¼ï¼šæ ¹æ®ç”¨æˆ·æœ€è¿‘çš„ä¸»åŠ¨è¯¢é—®å›ç­”ï¼Œè°ƒæ•´å¯¹è¯ç­–ç•¥å’Œå»ºè®®å†…å®¹ã€‚
```

### 3.4 AIå“åº”ç­–ç•¥è°ƒæ•´ | AI Response Strategy Adjustment

**åŸºäºé—®è¯¢æ´å¯Ÿï¼ŒAIä¼šè‡ªåŠ¨è°ƒæ•´å›ç­”ç­–ç•¥**:

| æ£€æµ‹åˆ°çš„çŠ¶æ€ | AIè°ƒæ•´ç­–ç•¥ |
|------------|-----------|
| ç¡çœ ä¸è¶³ï¼ˆ<6å°æ—¶ï¼‰ | - ä¼˜å…ˆå»ºè®®æ¢å¤æ€§æ´»åŠ¨<br>- é¿å…æ¨èé«˜å¼ºåº¦è¿åŠ¨<br>- å…³æ³¨ç¡çœ ä¼˜åŒ–è¯é¢˜ |
| é«˜å‹åŠ›ï¼ˆâ‰¥7/10ï¼‰ | - æ¨èæ”¾æ¾æŠ€å·§ï¼ˆå‘¼å¸ã€å†¥æƒ³ï¼‰<br>- é¿å…å¢åŠ è®¤çŸ¥è´Ÿè·<br>- å…³æ³¨å‹åŠ›ç®¡ç†è¯é¢˜ |
| ç¼ºä¹è¿åŠ¨ | - æ¸©å’Œè¯¢é—®è¿åŠ¨éšœç¢<br>- æä¾›ä½é—¨æ§›è¿åŠ¨å»ºè®®<br>- æ¨èå¾®è¿åŠ¨ä¹ æƒ¯ |
| æƒ…ç»ªä¸ä½³ | - æ›´å…³æ³¨å¿ƒç†å¥åº·<br>- æ¨èæƒ…ç»ªè°ƒèŠ‚æŠ€å·§<br>- å…³æ³¨ç¥ç»é€’è´¨è¯é¢˜ |

**ç¤ºä¾‹å¯¹è¯**:
```
ç”¨æˆ·: "æˆ‘ä»Šå¤©æƒ³å»è·‘æ­¥"

AIï¼ˆæ£€æµ‹åˆ°ç¡çœ ä¸è¶³ï¼‰:
"è€ƒè™‘åˆ°ä½ æœ€è¿‘ç¡çœ ä¸è¶³ï¼ˆå°‘äº6å°æ—¶ï¼‰ï¼Œä»Šå¤©å¯èƒ½ä¸å¤ªé€‚åˆé«˜å¼ºåº¦è·‘æ­¥ã€‚
ä½ çš„èº«ä½“æ­£åœ¨ä¼˜å…ˆè¿›è¡Œä¿®å¤è€Œéè¾“å‡ºã€‚å»ºè®®ä»Šå¤©é€‰æ‹©è½»åº¦æ´»åŠ¨ï¼Œæ¯”å¦‚æ•£æ­¥æˆ–æ‹‰ä¼¸ï¼Œ
è®©çº¿ç²’ä½“æœ‰æ—¶é—´æ¢å¤èƒ½é‡å‚¨å¤‡ã€‚æ˜å¤©ç¡çœ å……è¶³åå†è€ƒè™‘è·‘æ­¥ä¼šæ›´å®‰å…¨æœ‰æ•ˆã€‚"
```


---

## 4. å†…å®¹æ¨èå½±å“ | Content Recommendation Impact

### 4.1 åŠ¨æ€æ ‡ç­¾è°ƒæ•´ | Dynamic Tag Adjustment

**ä»£ç ä½ç½®**: `app/api/curated-feed/route.ts`

**é›†æˆæµç¨‹**:
```typescript
// 1. è·å–é—®è¯¢ä¸Šä¸‹æ–‡
const { getInquiryContext } = await import('@/lib/inquiry-context');
const inquiryContext = await getInquiryContext(userId);
const { insights, suggestedTopics } = inquiryContext;

// 2. æ ¹æ®æ´å¯ŸåŠ¨æ€æ·»åŠ æ ‡ç­¾
if (insights.recentSleepPattern === 'poor') {
  userTags.push('ç¡çœ é—®é¢˜');
  focusTopics.push('sleep_optimization', 'circadian_rhythm');
  console.log('ğŸ“‹ Inquiry: æ£€æµ‹åˆ°ç¡çœ ä¸è¶³ï¼Œä¼˜å…ˆæ¨èç¡çœ ç›¸å…³å†…å®¹');
}

if (insights.recentStressLevel === 'high') {
  userTags.push('é«˜çš®è´¨é†‡é£é™©');
  focusTopics.push('stress_management', 'cortisol_regulation');
  console.log('ğŸ“‹ Inquiry: æ£€æµ‹åˆ°é«˜å‹åŠ›ï¼Œä¼˜å…ˆæ¨èå‹åŠ›ç®¡ç†å†…å®¹');
}

if (insights.recentExercise === 'none') {
  focusTopics.push('exercise_benefits', 'zone2_cardio');
  console.log('ğŸ“‹ Inquiry: æ£€æµ‹åˆ°ç¼ºä¹è¿åŠ¨ï¼Œæ¨èè¿åŠ¨ç›¸å…³å†…å®¹');
}

if (insights.recentMood === 'bad') {
  userTags.push('æƒ…ç»ªå›°æ‰°');
  focusTopics.push('mental_health', 'neurotransmitters');
  console.log('ğŸ“‹ Inquiry: æ£€æµ‹åˆ°æƒ…ç»ªä¸ä½³ï¼Œæ¨èå¿ƒç†å¥åº·å†…å®¹');
}

// 3. æ·»åŠ å»ºè®®çš„ä¸»é¢˜
if (suggestedTopics.length > 0) {
  focusTopics.push(...suggestedTopics);
  console.log('ğŸ“‹ Inquiry å»ºè®®ä¸»é¢˜:', suggestedTopics.join(', '));
}
```

### 4.2 å†…å®¹åŒ¹é…ç®—æ³•è°ƒæ•´ | Content Matching Algorithm Adjustment

**å½±å“æœºåˆ¶**:

1. **å…³é”®è¯æ‰©å±•**: æ–°å¢çš„æ ‡ç­¾ä¼šæ‰©å±•å…³é”®è¯åˆ—è¡¨
   ```typescript
   const TAG_KEYWORD_MAP: Record<string, string[]> = {
     'ç¡çœ é—®é¢˜': ['sleep quality', 'insomnia treatment', 'circadian rhythm'],
     'é«˜çš®è´¨é†‡é£é™©': ['cortisol', 'stress response', 'anxiety disorder'],
     // ...
   };
   ```

2. **ç›¸å…³æ€§è¯„åˆ†æå‡**: åŒ¹é…æ–°æ ‡ç­¾çš„å†…å®¹ä¼šè·å¾—æ›´é«˜åˆ†æ•°
   ```typescript
   const keywordScore = calculateKeywordMatchScore(title, summary, keywords);
   const tagBoost = calculateTagRelevanceBoost(content, userTags) * 10;
   const matchScore = clampScore((baseScore + keywordScore) / 2 + tagBoost);
   ```

3. **æ’åºä¼˜å…ˆçº§è°ƒæ•´**: é«˜ç›¸å…³æ€§å†…å®¹æ’åœ¨å‰é¢
   ```typescript
   const scored = combined
     .map(item => ({ ...item, matchScore }))
     .sort((a, b) => b.matchScore - a.matchScore);
   ```


### 4.3 æ¨èæ•ˆæœç¤ºä¾‹ | Recommendation Effect Examples

**åœºæ™¯1: ç”¨æˆ·è¿ç»­3å¤©å›ç­”"ç¡çœ ä¸è¶³"**

**ç³»ç»Ÿå“åº”**:
- âœ… æ·»åŠ æ ‡ç­¾: `ç¡çœ é—®é¢˜`
- âœ… æ·»åŠ ç„¦ç‚¹è¯é¢˜: `sleep_optimization`, `circadian_rhythm`
- âœ… æ‰©å±•å…³é”®è¯: `sleep quality`, `insomnia treatment`, `melatonin`

**æ¨èå†…å®¹å˜åŒ–**:
```
ä¼˜å…ˆæ¨é€:
1. "Sleep Optimization: Evidence-Based Strategies" (PubMed)
2. "Circadian Rhythm and Mental Health" (Semantic Scholar)
3. "è¤ªé»‘ç´ è¡¥å……å‰‚çš„ç§‘å­¦è¯æ®" (YouTube)
4. "å¦‚ä½•å»ºç«‹å¥åº·çš„ç¡çœ ä¹ æƒ¯" (Reddit)
```

---

**åœºæ™¯2: ç”¨æˆ·å›ç­”"å‹åŠ›å¾ˆå¤§"**

**ç³»ç»Ÿå“åº”**:
- âœ… æ·»åŠ æ ‡ç­¾: `é«˜çš®è´¨é†‡é£é™©`
- âœ… æ·»åŠ ç„¦ç‚¹è¯é¢˜: `stress_management`, `cortisol_regulation`, `breathing_exercises`
- âœ… æ‰©å±•å…³é”®è¯: `cortisol`, `stress response`, `HRV biofeedback`

**æ¨èå†…å®¹å˜åŒ–**:
```
ä¼˜å…ˆæ¨é€:
1. "Cortisol Regulation Through Breathing Techniques" (PubMed)
2. "HRV Biofeedback for Stress Management" (Semantic Scholar)
3. "ç›’å¼å‘¼å¸æ³•ï¼šå¿«é€Ÿé™ä½å‹åŠ›" (YouTube)
4. "å‹åŠ›ç®¡ç†çš„ç¥ç»ç§‘å­¦åŸºç¡€" (X)
```

---

**åœºæ™¯3: ç”¨æˆ·å›ç­”"æ²¡æœ‰è¿åŠ¨"**

**ç³»ç»Ÿå“åº”**:
- âœ… æ·»åŠ ç„¦ç‚¹è¯é¢˜: `exercise_benefits`, `zone2_cardio`
- âœ… æ‰©å±•å…³é”®è¯: `exercise`, `cardiovascular health`, `zone 2 training`

**æ¨èå†…å®¹å˜åŒ–**:
```
ä¼˜å…ˆæ¨é€:
1. "Zone 2 Cardio: The Science of Low-Intensity Training" (PubMed)
2. "Exercise and Mental Health: A Meta-Analysis" (Semantic Scholar)
3. "10åˆ†é’Ÿå¾®è¿åŠ¨ï¼šé›¶é—¨æ§›å¼€å§‹" (YouTube)
4. "è¿åŠ¨å¦‚ä½•æ”¹å–„å¤§è„‘åŠŸèƒ½" (Reddit)
```

---

## 5. ç•Œé¢äº¤äº’è®¾è®¡ | UI Interaction Design

### 5.1 Bannerç»„ä»¶æ¶æ„ | Banner Component Architecture

**ä»£ç ä½ç½®**: `components/ActiveInquiryBanner.tsx`

**ç»„ä»¶èŒè´£**:
1. ä»APIè·å–å¾…å›ç­”çš„é—®è¯¢é—®é¢˜
2. æ˜¾ç¤ºé—®é¢˜æ–‡æœ¬å’Œé€‰é¡¹æŒ‰é’®
3. å¤„ç†ç”¨æˆ·ç‚¹å‡»é€‰é¡¹
4. æäº¤å›ç­”åˆ°åç«¯
5. æ˜¾ç¤ºæˆåŠŸ/é”™è¯¯çŠ¶æ€
6. æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢


**ç»„ä»¶çŠ¶æ€ç®¡ç†**:
```typescript
const [inquiry, setInquiry] = useState<InquiryQuestion | null>(null);
const [isSubmitting, setIsSubmitting] = useState(false);
const [showSuccess, setShowSuccess] = useState(false);
```

**æ•°æ®è·å–æµç¨‹**:
```typescript
useEffect(() => {
  const fetchInquiry = async () => {
    const response = await fetch(
      `/api/inquiry/pending?language=${language}`,
      { credentials: 'include' }
    );
    const data = await response.json();
    if (data.hasInquiry) {
      setInquiry(data.inquiry);
    }
  };
  fetchInquiry();
}, [language]); // â† è¯­è¨€å˜åŒ–æ—¶é‡æ–°è·å–
```

**å›ç­”æäº¤æµç¨‹**:
```typescript
const handleOptionClick = async (optionValue: string) => {
  setIsSubmitting(true);
  
  const response = await fetch('/api/inquiry/respond', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      inquiryId: inquiry.id,
      response: optionValue
    }),
    credentials: 'include'
  });
  
  if (response.ok) {
    setShowSuccess(true);
    setTimeout(() => {
      setInquiry(null); // éšè—Banner
    }, 2000);
  }
  
  setIsSubmitting(false);
};
```

### 5.2 è§†è§‰è®¾è®¡è§„èŒƒ | Visual Design Specifications

**ä½ç½®**: å›ºå®šåœ¨é¡µé¢å³ä¸‹è§’ï¼ŒMaxèŠå¤©æŒ‰é’®ä¸Šæ–¹
```css
position: fixed;
bottom: 24px;  /* 6rem */
right: 24px;   /* 6rem */
z-index: 99999; /* æœ€é«˜å±‚çº§ */
```

**æ ·å¼**: èŠå¤©æ°”æ³¡é£æ ¼
```css
background: rgba(255, 255, 255, 0.95);
backdrop-filter: blur(12px);
border-radius: 24px;
box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
padding: 20px;
max-width: 380px;
```

**æ°”æ³¡å°¾å·´**: æŒ‡å‘å³ä¸‹è§’
```css
&::after {
  content: '';
  position: absolute;
  bottom: -8px;
  right: 32px;
  width: 0;
  height: 0;
  border-left: 12px solid transparent;
  border-right: 12px solid transparent;
  border-top: 12px solid rgba(255, 255, 255, 0.95);
}
```

**å“ç‰Œè‰²**: Maxç»¿è‰²æ¸å˜
```css
.max-badge {
  background: linear-gradient(135deg, #9CAF88 0%, #7A9B6E 100%);
  color: white;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
}
```


### 5.3 äº¤äº’çŠ¶æ€è®¾è®¡ | Interaction State Design

**çŠ¶æ€1: åˆå§‹æ˜¾ç¤º**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– MAX ä¸»åŠ¨å…³æ€€                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ˜¨æ™šç¡å¾—æ€ä¹ˆæ ·ï¼Ÿå¤§æ¦‚ç¡äº†å‡ ä¸ªå°æ—¶ï¼Ÿ      â”‚
â”‚                                     â”‚
â”‚ [ä¸åˆ°6å°æ—¶] [6-7å°æ—¶]                â”‚
â”‚ [7-8å°æ—¶]   [8å°æ—¶ä»¥ä¸Š]              â”‚
â”‚                                     â”‚
â”‚ [ç¨åå›ç­”]                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€2: æäº¤ä¸­**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤– MAX ä¸»åŠ¨å…³æ€€                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ˜¨æ™šç¡å¾—æ€ä¹ˆæ ·ï¼Ÿå¤§æ¦‚ç¡äº†å‡ ä¸ªå°æ—¶ï¼Ÿ      â”‚
â”‚                                     â”‚
â”‚ [ä¸åˆ°6å°æ—¶] [6-7å°æ—¶] â† å·²é€‰ä¸­        â”‚
â”‚ [7-8å°æ—¶]   [8å°æ—¶ä»¥ä¸Š]              â”‚
â”‚                                     â”‚
â”‚ â³ æäº¤ä¸­...                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€3: æˆåŠŸåé¦ˆ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… æ„Ÿè°¢ä½ çš„å›ç­”ï¼                     â”‚
â”‚                                     â”‚
â”‚ è¿™å°†å¸®åŠ©æˆ‘æ›´å¥½åœ°äº†è§£ä½ çš„çŠ¶æ€ã€‚         â”‚
â”‚                                     â”‚
â”‚ (2ç§’åè‡ªåŠ¨æ¶ˆå¤±)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**çŠ¶æ€4: é”™è¯¯å¤„ç†**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âŒ æäº¤å¤±è´¥                          â”‚
â”‚                                     â”‚
â”‚ è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•                  â”‚
â”‚                                     â”‚
â”‚ [é‡è¯•]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 å“åº”å¼è®¾è®¡ | Responsive Design

**æ¡Œé¢ç«¯** (>768px):
- å›ºå®šåœ¨å³ä¸‹è§’
- å®½åº¦: 380px
- ä¸MaxæŒ‰é’®ä¿æŒ16pxé—´è·

**ç§»åŠ¨ç«¯** (<768px):
- å›ºå®šåœ¨åº•éƒ¨ä¸­å¤®
- å®½åº¦: calc(100% - 32px)
- æœ€å¤§å®½åº¦: 380px
- åº•éƒ¨ç•™å‡ºå®‰å…¨åŒºåŸŸ

```css
@media (max-width: 768px) {
  .inquiry-banner {
    left: 16px;
    right: 16px;
    bottom: 80px; /* ä¸ºMaxæŒ‰é’®ç•™ç©ºé—´ */
    max-width: 380px;
    margin: 0 auto;
  }
}
```


---

## 6. è®°å¿†ç³»ç»Ÿé›†æˆ | Memory System Integration

### 6.1 AIè®°å¿†ç³»ç»Ÿæ¦‚è¿° | AI Memory System Overview

**ä»£ç ä½ç½®**: `lib/aiMemory.ts`

**æ ¸å¿ƒåŠŸèƒ½**:
1. å°†å¯¹è¯å†…å®¹è½¬æ¢ä¸ºå‘é‡åµŒå…¥ï¼ˆembeddingsï¼‰
2. å­˜å‚¨åˆ° `ai_memory` è¡¨
3. åŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦æ£€ç´¢å†å²è®°å¿†
4. æ³¨å…¥åˆ°AIç³»ç»Ÿæç¤ºä¸­

### 6.2 é—®è¯¢æ•°æ®çš„è®°å¿†å­˜å‚¨ | Inquiry Data Memory Storage

**å½“å‰å®ç°**: é—®è¯¢å›ç­”**ä¸ç›´æ¥**å­˜å‚¨åˆ°AIè®°å¿†ç³»ç»Ÿ

**åŸå› **:
1. é—®è¯¢æ•°æ®å·²å­˜å‚¨åœ¨ `inquiry_history` è¡¨
2. é€šè¿‡ `inquiry-context.ts` æå–æ´å¯Ÿ
3. ä»¥ç»“æ„åŒ–æ‘˜è¦å½¢å¼æ³¨å…¥åˆ°AIæç¤º

**æœªæ¥ä¼˜åŒ–æ–¹å‘**:
å¯ä»¥è€ƒè™‘å°†é—®è¯¢å¯¹è¯ä¹Ÿå­˜å‚¨åˆ°AIè®°å¿†ç³»ç»Ÿï¼Œä»¥ä¾¿ï¼š
- AIèƒ½å›å¿†èµ·å…·ä½“çš„é—®è¯¢å¯¹è¯
- æä¾›æ›´è¿è´¯çš„å¯¹è¯ä½“éªŒ
- ä¾‹å¦‚ï¼š"ä½ æ˜¨å¤©å‘Šè¯‰æˆ‘ç¡çœ ä¸è¶³ï¼Œä»Šå¤©æ„Ÿè§‰å¥½äº›äº†å—ï¼Ÿ"

### 6.3 å»ºè®®çš„è®°å¿†å­˜å‚¨å¢å¼º | Suggested Memory Storage Enhancement

**å®ç°æ–¹æ¡ˆ**:

åœ¨ `app/api/inquiry/respond/route.ts` ä¸­æ·»åŠ è®°å¿†å­˜å‚¨ï¼š

```typescript
import { generateEmbedding, storeMemory } from '@/lib/aiMemory';

// åœ¨æˆåŠŸæ›´æ–° inquiry_history å
if (updatedInquiry) {
  try {
    // æ„å»ºå¯¹è¯æ ¼å¼
    const questionText = `[ä¸»åŠ¨é—®è¯¢] ${updatedInquiry.question_text}`;
    const answerText = `[ç”¨æˆ·å›ç­”] ${response}`;
    
    // å­˜å‚¨é—®é¢˜åˆ°è®°å¿†
    const questionEmbedding = await generateEmbedding(questionText);
    await storeMemory(userId, questionText, 'assistant', questionEmbedding, {
      type: 'inquiry_question',
      inquiry_id: inquiryId,
      data_gap: dataGaps[0]
    });
    
    // å­˜å‚¨å›ç­”åˆ°è®°å¿†
    const answerEmbedding = await generateEmbedding(answerText);
    await storeMemory(userId, answerText, 'user', answerEmbedding, {
      type: 'inquiry_response',
      inquiry_id: inquiryId,
      data_gap: dataGaps[0]
    });
    
    console.log('âœ… é—®è¯¢å¯¹è¯å·²å­˜å‚¨åˆ°AIè®°å¿†ç³»ç»Ÿ');
  } catch (error) {
    console.warn('âš ï¸ å­˜å‚¨é—®è¯¢è®°å¿†å¤±è´¥:', error);
    // ä¸å½±å“ä¸»æµç¨‹
  }
}
```

**ä¼˜åŠ¿**:
1. AIå¯ä»¥å›å¿†èµ·å…·ä½“çš„é—®è¯¢å¯¹è¯
2. æä¾›æ›´è‡ªç„¶çš„å¯¹è¯è¿ç»­æ€§
3. æ”¯æŒåŸºäºå†å²é—®è¯¢çš„ä¸ªæ€§åŒ–å»ºè®®


---

## 7. å®Œæ•´ç³»ç»Ÿæ¶æ„å›¾ | Complete System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢å±‚ | UI Layer                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ActiveInquiryBanner Component                               â”‚  â”‚
â”‚  â”‚  - æ˜¾ç¤ºé—®è¯¢é—®é¢˜                                               â”‚  â”‚
â”‚  â”‚  - å¤„ç†ç”¨æˆ·å›ç­”                                               â”‚  â”‚
â”‚  â”‚  - æ”¯æŒå¤šè¯­è¨€åˆ‡æ¢                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“ â†‘                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         APIè·¯ç”±å±‚ | API Routes                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ GET /api/inquiry/      â”‚  â”‚ POST /api/inquiry/     â”‚            â”‚
â”‚  â”‚ pending                â”‚  â”‚ respond                â”‚            â”‚
â”‚  â”‚ - è·å–å¾…å›ç­”é—®é¢˜        â”‚  â”‚ - æäº¤ç”¨æˆ·å›ç­”          â”‚            â”‚
â”‚  â”‚ - æ”¯æŒè¯­è¨€å‚æ•°          â”‚  â”‚ - åŒæ­¥åˆ°å¤šä¸ªè¡¨          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â†“ â†‘                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä¸šåŠ¡é€»è¾‘å±‚ | Business Logic                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ inquiry-engine.ts      â”‚  â”‚ inquiry-context.ts     â”‚            â”‚
â”‚  â”‚ - æ£€æµ‹æ•°æ®ç¼ºå£          â”‚  â”‚ - æå–å¥åº·æ´å¯Ÿ          â”‚            â”‚
â”‚  â”‚ - ç”Ÿæˆé—®è¯¢é—®é¢˜          â”‚  â”‚ - ç”Ÿæˆè‡ªç„¶è¯­è¨€æ‘˜è¦       â”‚            â”‚
â”‚  â”‚ - ä¼˜å…ˆçº§æ’åº            â”‚  â”‚ - æ¨èç›¸å…³è¯é¢˜          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â†“ â†‘                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       æ•°æ®å­˜å‚¨å±‚ | Data Storage                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ inquiry_history  â”‚  â”‚ daily_           â”‚  â”‚ user_activity_  â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚ calibrations     â”‚  â”‚ patterns        â”‚  â”‚
â”‚  â”‚ - é—®è¯¢è®°å½•        â”‚  â”‚ - æ¯æ—¥æ ¡å‡†æ•°æ®    â”‚  â”‚ - æ´»è·ƒæ—¶é—´æ¨¡å¼   â”‚  â”‚
â”‚  â”‚ - ç”¨æˆ·å›ç­”        â”‚  â”‚ - ç»“æ„åŒ–å¥åº·æ•°æ®  â”‚  â”‚ - æœ€ä½³é—®è¯¢æ—¶æœº   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“ â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¶ˆè´¹ç³»ç»Ÿå±‚ | Consumer Systems                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ AI Chat System         â”‚  â”‚ Content Feed System    â”‚            â”‚
â”‚  â”‚ (chat/route.ts)        â”‚  â”‚ (curated-feed/route.ts)â”‚            â”‚
â”‚  â”‚                        â”‚  â”‚                        â”‚            â”‚
â”‚  â”‚ âœ“ è·å–é—®è¯¢æ´å¯Ÿ          â”‚  â”‚ âœ“ è·å–é—®è¯¢æ´å¯Ÿ          â”‚            â”‚
â”‚  â”‚ âœ“ ç”Ÿæˆè‡ªç„¶è¯­è¨€æ‘˜è¦       â”‚  â”‚ âœ“ åŠ¨æ€è°ƒæ•´æ ‡ç­¾          â”‚            â”‚
â”‚  â”‚ âœ“ æ³¨å…¥åˆ°ç³»ç»Ÿæç¤º         â”‚  â”‚ âœ“ è°ƒæ•´æ¨èç®—æ³•          â”‚            â”‚
â”‚  â”‚ âœ“ è°ƒæ•´å›ç­”ç­–ç•¥          â”‚  â”‚ âœ“ ä¼˜å…ˆæ¨é€ç›¸å…³å†…å®¹       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

## 8. æ•°æ®æµæ—¶åºå›¾ | Data Flow Sequence Diagram

```
ç”¨æˆ·          Bannerç»„ä»¶      API(pending)    inquiry-engine    æ•°æ®åº“
 â”‚               â”‚                â”‚                â”‚             â”‚
 â”‚  æ‰“å¼€é¡µé¢      â”‚                â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚             â”‚
 â”‚               â”‚  GET /pending  â”‚                â”‚             â”‚
 â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚             â”‚
 â”‚               â”‚                â”‚  æŸ¥è¯¢æœ€è¿‘æ•°æ®    â”‚             â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚               â”‚                â”‚                â”‚  è¿”å›æ•°æ®   â”‚
 â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚               â”‚                â”‚  æ£€æµ‹æ•°æ®ç¼ºå£    â”‚             â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
 â”‚               â”‚                â”‚  è¿”å›ç¼ºå£åˆ—è¡¨    â”‚             â”‚
 â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚               â”‚                â”‚  ç”Ÿæˆé—®é¢˜(zh)   â”‚             â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚             â”‚
 â”‚               â”‚                â”‚  è¿”å›é—®é¢˜       â”‚             â”‚
 â”‚               â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
 â”‚               â”‚  è¿”å›é—®é¢˜JSON   â”‚                â”‚             â”‚
 â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚
 â”‚  æ˜¾ç¤ºé—®é¢˜      â”‚                â”‚                â”‚             â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚             â”‚
 â”‚               â”‚                â”‚                â”‚             â”‚
 â”‚  ç‚¹å‡»é€‰é¡¹      â”‚                â”‚                â”‚             â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚             â”‚
 â”‚               â”‚ POST /respond  â”‚                â”‚             â”‚
 â”‚               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚             â”‚
 â”‚               â”‚                â”‚  æ›´æ–°inquiry_history          â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚               â”‚                â”‚  åŒæ­¥daily_calibrations       â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚               â”‚                â”‚  æ›´æ–°activity_patterns        â”‚
 â”‚               â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚               â”‚  è¿”å›æˆåŠŸ       â”‚                â”‚             â”‚
 â”‚               â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚             â”‚
 â”‚  æ˜¾ç¤ºæˆåŠŸ      â”‚                â”‚                â”‚             â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚             â”‚
 â”‚               â”‚                â”‚                â”‚             â”‚
 â”‚  2ç§’åéšè—     â”‚                â”‚                â”‚             â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚                â”‚             â”‚
```

---

## 9. å…³é”®ä»£ç ä½ç½®ç´¢å¼• | Key Code Location Index

### å‰ç«¯ç»„ä»¶ | Frontend Components
- **Bannerç»„ä»¶**: `components/ActiveInquiryBanner.tsx`
- **Landingé¡µé¢**: `components/LandingContent.tsx`
- **å›½é™…åŒ–å­—å…¸**: `lib/i18n-dict.ts`

### APIè·¯ç”± | API Routes
- **è·å–é—®é¢˜**: `app/api/inquiry/pending/route.ts`
- **æäº¤å›ç­”**: `app/api/inquiry/respond/route.ts`
- **AIå¯¹è¯**: `app/api/chat/route.ts`
- **å†…å®¹æ¨è**: `app/api/curated-feed/route.ts`

### ä¸šåŠ¡é€»è¾‘ | Business Logic
- **é—®è¯¢å¼•æ“**: `lib/inquiry-engine.ts`
  - `identifyDataGaps()` - æ£€æµ‹æ•°æ®ç¼ºå£
  - `prioritizeDataGaps()` - ä¼˜å…ˆçº§æ’åº
  - `generateInquiryQuestion()` - ç”Ÿæˆé—®é¢˜
  - `getInquiryOptionsForGap()` - è·å–é€‰é¡¹
  
- **é—®è¯¢ä¸Šä¸‹æ–‡**: `lib/inquiry-context.ts`
  - `getInquiryContext()` - æå–æ´å¯Ÿ
  - `generateInquirySummary()` - ç”Ÿæˆæ‘˜è¦

### æ•°æ®åº“è¡¨ | Database Tables
- `inquiry_history` - é—®è¯¢å†å²è®°å½•
- `daily_calibrations` - æ¯æ—¥æ ¡å‡†æ•°æ®
- `user_activity_patterns` - ç”¨æˆ·æ´»è·ƒæ¨¡å¼
- `ai_memory` - AIè®°å¿†ç³»ç»Ÿï¼ˆå¯é€‰é›†æˆï¼‰


---

## 10. æµ‹è¯•éªŒè¯æ¸…å• | Testing Verification Checklist

### 10.1 åŠŸèƒ½æµ‹è¯• | Functional Testing

- [ ] **é—®é¢˜ç”Ÿæˆæµ‹è¯•**
  - [ ] æ— æ•°æ®æ—¶ç”Ÿæˆé«˜ä¼˜å…ˆçº§é—®é¢˜ï¼ˆç¡çœ /å‹åŠ›ï¼‰
  - [ ] æœ‰éƒ¨åˆ†æ•°æ®æ—¶ç”Ÿæˆç¼ºå¤±ç»´åº¦é—®é¢˜
  - [ ] æ‰€æœ‰æ•°æ®å®Œæ•´æ—¶ä¸æ˜¾ç¤ºBanner
  - [ ] æ•°æ®è¿‡æœŸï¼ˆ>24hï¼‰æ—¶é‡æ–°è¯¢é—®

- [ ] **è¯­è¨€åˆ‡æ¢æµ‹è¯•**
  - [ ] ä¸­æ–‡ç•Œé¢æ˜¾ç¤ºä¸­æ–‡é—®é¢˜å’Œé€‰é¡¹
  - [ ] è‹±æ–‡ç•Œé¢æ˜¾ç¤ºè‹±æ–‡é—®é¢˜å’Œé€‰é¡¹
  - [ ] åˆ‡æ¢è¯­è¨€æ—¶é—®é¢˜å®æ—¶æ›´æ–°
  - [ ] é€‰é¡¹å€¼ä¿æŒä¸€è‡´ï¼ˆvalueä¸å˜ï¼‰

- [ ] **å›ç­”æäº¤æµ‹è¯•**
  - [ ] ç‚¹å‡»é€‰é¡¹åæ­£ç¡®æäº¤
  - [ ] æäº¤ä¸­æ˜¾ç¤ºloadingçŠ¶æ€
  - [ ] æäº¤æˆåŠŸæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
  - [ ] 2ç§’åBannerè‡ªåŠ¨æ¶ˆå¤±
  - [ ] æäº¤å¤±è´¥æ˜¾ç¤ºé”™è¯¯æç¤º

- [ ] **æ•°æ®åŒæ­¥æµ‹è¯•**
  - [ ] å›ç­”åŒæ­¥åˆ° `inquiry_history` è¡¨
  - [ ] å›ç­”åŒæ­¥åˆ° `daily_calibrations` è¡¨
  - [ ] å€¼æ˜ å°„æ­£ç¡®ï¼ˆå¦‚ under_6 â†’ 5ï¼‰
  - [ ] æ´»è·ƒæ—¶é—´è®°å½•åˆ° `user_activity_patterns`

### 10.2 é›†æˆæµ‹è¯• | Integration Testing

- [ ] **AIå¯¹è¯é›†æˆ**
  - [ ] é—®è¯¢æ´å¯Ÿæ­£ç¡®æå–
  - [ ] è‡ªç„¶è¯­è¨€æ‘˜è¦ç”Ÿæˆæ­£ç¡®
  - [ ] æ‘˜è¦æ³¨å…¥åˆ°ç³»ç»Ÿæç¤º
  - [ ] AIå›ç­”è€ƒè™‘é—®è¯¢çŠ¶æ€
  - [ ] ç¡çœ ä¸è¶³æ—¶é¿å…æ¨èé«˜å¼ºåº¦è¿åŠ¨
  - [ ] é«˜å‹åŠ›æ—¶æ¨èæ”¾æ¾æŠ€å·§

- [ ] **å†…å®¹æ¨èé›†æˆ**
  - [ ] é—®è¯¢æ´å¯Ÿå½±å“æ ‡ç­¾
  - [ ] æ ‡ç­¾å½±å“å…³é”®è¯æ‰©å±•
  - [ ] å…³é”®è¯å½±å“å†…å®¹åŒ¹é…
  - [ ] æ¨èå†…å®¹ä¸é—®è¯¢çŠ¶æ€ç›¸å…³
  - [ ] ç¡çœ ä¸è¶³æ—¶æ¨èç¡çœ ä¼˜åŒ–å†…å®¹
  - [ ] é«˜å‹åŠ›æ—¶æ¨èå‹åŠ›ç®¡ç†å†…å®¹

### 10.3 æ€§èƒ½æµ‹è¯• | Performance Testing

- [ ] **å“åº”æ—¶é—´**
  - [ ] é—®é¢˜ç”Ÿæˆ < 500ms
  - [ ] å›ç­”æäº¤ < 1s
  - [ ] è¯­è¨€åˆ‡æ¢ < 300ms
  - [ ] æ´å¯Ÿæå– < 200ms

- [ ] **å¹¶å‘æµ‹è¯•**
  - [ ] å¤šç”¨æˆ·åŒæ—¶è·å–é—®é¢˜
  - [ ] å¤šç”¨æˆ·åŒæ—¶æäº¤å›ç­”
  - [ ] æ•°æ®åº“è¿æ¥æ± æ­£å¸¸

### 10.4 è¾¹ç•Œæµ‹è¯• | Edge Case Testing

- [ ] **å¼‚å¸¸æƒ…å†µ**
  - [ ] ç½‘ç»œæ–­å¼€æ—¶çš„å¤„ç†
  - [ ] APIè¶…æ—¶æ—¶çš„å¤„ç†
  - [ ] æ•°æ®åº“å†™å…¥å¤±è´¥æ—¶çš„å¤„ç†
  - [ ] æ— æ•ˆå›ç­”å€¼çš„å¤„ç†

- [ ] **ç‰¹æ®Šåœºæ™¯**
  - [ ] æ–°ç”¨æˆ·ï¼ˆæ— å†å²æ•°æ®ï¼‰
  - [ ] é•¿æœŸä¸æ´»è·ƒç”¨æˆ·
  - [ ] æ•°æ®å®Œæ•´çš„ç”¨æˆ·
  - [ ] é¢‘ç¹åˆ‡æ¢è¯­è¨€çš„ç”¨æˆ·


---

## 11. æœªæ¥ä¼˜åŒ–æ–¹å‘ | Future Optimization Directions

### 11.1 æ™ºèƒ½æ—¶æœºä¼˜åŒ– | Intelligent Timing Optimization

**å½“å‰çŠ¶æ€**: Banneråœ¨ç”¨æˆ·æ‰“å¼€é¡µé¢æ—¶æ˜¾ç¤ºï¼ˆå¦‚æœæœ‰å¾…å›ç­”é—®é¢˜ï¼‰

**ä¼˜åŒ–æ–¹å‘**:
1. **åŸºäºæ´»è·ƒæ¨¡å¼æ¨é€**
   - åˆ†æç”¨æˆ·å†å²æ´»è·ƒæ—¶é—´
   - åœ¨æœ€ä½³æ—¶æœºå‘é€æ¨é€é€šçŸ¥
   - æé«˜å›ç­”ç‡

2. **é¿å…æ‰“æ‰°æ—¶æ®µ**
   - è¯†åˆ«ç”¨æˆ·å·¥ä½œ/ä¼‘æ¯æ—¶é—´
   - é¿å…åœ¨æ·±å¤œæˆ–å·¥ä½œé«˜å³°æœŸè¯¢é—®
   - æå‡ç”¨æˆ·ä½“éªŒ

**å®ç°å‚è€ƒ**: `lib/inquiry-engine.ts` â†’ `calculateOptimalTiming()`

### 11.2 é—®é¢˜æ·±åº¦è¿›åŒ– | Question Depth Evolution

**å½“å‰çŠ¶æ€**: é—®é¢˜æ¨¡æ¿å›ºå®šï¼Œæ·±åº¦ä¸å˜

**ä¼˜åŒ–æ–¹å‘**:
1. **åŸºäºå›ç­”å†å²è°ƒæ•´é—®é¢˜æ·±åº¦**
   - åˆæœŸï¼šç®€å•é€‰æ‹©é¢˜
   - ä¸­æœŸï¼šå¸¦é‡åŒ–çš„é—®é¢˜
   - åæœŸï¼šå¼€æ”¾å¼è¯Šæ–­é—®é¢˜

2. **åŠ¨æ€ç”Ÿæˆä¸ªæ€§åŒ–é—®é¢˜**
   - åŸºäºç”¨æˆ·ç‰¹å¾ç”Ÿæˆé—®é¢˜
   - ä¾‹å¦‚ï¼š"ä½ æ˜¨å¤©æåˆ°è…¿ç–¼ï¼Œä»Šå¤©æ„Ÿè§‰å¦‚ä½•ï¼Ÿ"

### 11.3 AIè®°å¿†ç³»ç»Ÿå®Œæ•´é›†æˆ | Full AI Memory System Integration

**å½“å‰çŠ¶æ€**: é—®è¯¢æ•°æ®é€šè¿‡ç»“æ„åŒ–æ‘˜è¦æ³¨å…¥

**ä¼˜åŒ–æ–¹å‘**:
1. **å­˜å‚¨é—®è¯¢å¯¹è¯åˆ°AIè®°å¿†**
   - é—®é¢˜å’Œå›ç­”éƒ½å­˜å‚¨ä¸ºå‘é‡
   - æ”¯æŒè¯­ä¹‰æ£€ç´¢
   - AIèƒ½å›å¿†å…·ä½“å¯¹è¯

2. **è·¨ä¼šè¯è¿ç»­æ€§**
   - "ä½ ä¸Šå‘¨å‘Šè¯‰æˆ‘ç¡çœ ä¸è¶³ï¼Œç°åœ¨æ”¹å–„äº†å—ï¼Ÿ"
   - "ä½ ä¹‹å‰è¯´å‹åŠ›å¤§ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿›å±•"

**å®ç°å»ºè®®**: å‚è€ƒæœ¬æ–‡æ¡£ 6.3 èŠ‚

### 11.4 å¤šæ¨¡æ€é—®è¯¢ | Multi-modal Inquiry

**å½“å‰çŠ¶æ€**: ä»…æ”¯æŒé€‰æ‹©é¢˜

**ä¼˜åŒ–æ–¹å‘**:
1. **æ”¯æŒæ›´å¤šè¾“å…¥ç±»å‹**
   - æ»‘å—ï¼ˆ1-10é‡è¡¨ï¼‰
   - æ–‡æœ¬è¾“å…¥ï¼ˆå¼€æ”¾å¼å›ç­”ï¼‰
   - å›¾ç‰‡ä¸Šä¼ ï¼ˆå¦‚ç¡çœ æ—¥å¿—æˆªå›¾ï¼‰

2. **è¯­éŸ³é—®è¯¢**
   - è¯­éŸ³æ’­æŠ¥é—®é¢˜
   - è¯­éŸ³å›ç­”
   - æå‡ä¾¿æ·æ€§

### 11.5 é—®è¯¢æ•ˆæœåˆ†æ | Inquiry Effectiveness Analysis

**å½“å‰çŠ¶æ€**: ä»…è®°å½•å›ç­”ï¼Œæ— æ•ˆæœåˆ†æ

**ä¼˜åŒ–æ–¹å‘**:
1. **å›ç­”ç‡åˆ†æ**
   - å“ªäº›é—®é¢˜å›ç­”ç‡é«˜
   - å“ªäº›æ—¶é—´æ®µå›ç­”ç‡é«˜
   - ä¼˜åŒ–é—®é¢˜è®¾è®¡

2. **æ•°æ®è´¨é‡åˆ†æ**
   - é—®è¯¢æ•°æ®ä¸æ‰‹åŠ¨è®°å½•çš„ä¸€è‡´æ€§
   - é—®è¯¢æ•°æ®å¯¹AIå»ºè®®çš„å½±å“
   - æŒç»­ä¼˜åŒ–é—®é¢˜æ¨¡æ¿

3. **ç”¨æˆ·æ»¡æ„åº¦**
   - é—®è¯¢æ˜¯å¦æœ‰å¸®åŠ©
   - é—®è¯¢é¢‘ç‡æ˜¯å¦åˆé€‚
   - æ”¶é›†ç”¨æˆ·åé¦ˆ


---

## 12. å¸¸è§é—®é¢˜è§£ç­” | FAQ

### Q1: é—®é¢˜æ˜¯é¢„è®¾çš„è¿˜æ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Ÿ
**A**: åŠ¨æ€ç”Ÿæˆã€‚ç³»ç»Ÿä¼šæ£€æµ‹ç”¨æˆ·åœ¨6ä¸ªå¥åº·ç»´åº¦çš„æ•°æ®å®Œæ•´æ€§ï¼Œä¼˜å…ˆè¯¢é—®ç¼ºå¤±æˆ–è¿‡æœŸçš„é«˜ä¼˜å…ˆçº§æ•°æ®ï¼ˆç¡çœ ã€å‹åŠ›ï¼‰ã€‚

### Q2: ä¸ºä»€ä¹ˆæˆ‘çœ‹åˆ°çš„é—®é¢˜å’Œåˆ«äººä¸ä¸€æ ·ï¼Ÿ
**A**: å› ä¸ºæ¯ä¸ªç”¨æˆ·çš„æ•°æ®ç¼ºå£ä¸åŒã€‚ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„å…·ä½“æƒ…å†µç”Ÿæˆæœ€ç›¸å…³çš„é—®é¢˜ã€‚

### Q3: å›ç­”é—®é¢˜åæ•°æ®ä¼šå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ
**A**: ä¸‰ä¸ªåœ°æ–¹ï¼š
1. `inquiry_history` - å®Œæ•´çš„é—®è¯¢è®°å½•
2. `daily_calibrations` - è½¬æ¢ä¸ºç»“æ„åŒ–å¥åº·æ•°æ®
3. `user_activity_patterns` - è®°å½•ä½ çš„æ´»è·ƒæ—¶é—´

### Q4: å›ç­”é—®é¢˜ä¼šå½±å“AIçš„å»ºè®®å—ï¼Ÿ
**A**: ä¼šã€‚AIä¼šæ ¹æ®ä½ çš„å›ç­”è°ƒæ•´å»ºè®®ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ å›ç­”"ç¡çœ ä¸è¶³"ï¼ŒAIä¼šé¿å…æ¨èé«˜å¼ºåº¦è¿åŠ¨ï¼Œä¼˜å…ˆå»ºè®®æ¢å¤æ€§æ´»åŠ¨ã€‚

### Q5: å›ç­”é—®é¢˜ä¼šå½±å“å†…å®¹æ¨èå—ï¼Ÿ
**A**: ä¼šã€‚ç³»ç»Ÿä¼šæ ¹æ®ä½ çš„å›ç­”åŠ¨æ€è°ƒæ•´æ¨èæ ‡ç­¾å’Œå…³é”®è¯ã€‚ä¾‹å¦‚ï¼Œå›ç­”"å‹åŠ›å¾ˆå¤§"åï¼Œä¼šä¼˜å…ˆæ¨èå‹åŠ›ç®¡ç†ã€çš®è´¨é†‡è°ƒèŠ‚ç›¸å…³çš„ç§‘å­¦å†…å®¹ã€‚

### Q6: å¯ä»¥è·³è¿‡é—®é¢˜å—ï¼Ÿ
**A**: å¯ä»¥ã€‚ç‚¹å‡»"ç¨åå›ç­”"æŒ‰é’®å³å¯æš‚æ—¶éšè—Bannerã€‚ä½†å»ºè®®å›ç­”ï¼Œå› ä¸ºè¿™èƒ½å¸®åŠ©ç³»ç»Ÿæ›´å¥½åœ°äº†è§£ä½ çš„çŠ¶æ€ã€‚

### Q7: é—®é¢˜ä¼šé‡å¤å‡ºç°å—ï¼Ÿ
**A**: ä¼šã€‚å¦‚æœæŸä¸ªç»´åº¦çš„æ•°æ®è¶…è¿‡24å°æ—¶æœªæ›´æ–°ï¼Œç³»ç»Ÿä¼šå†æ¬¡è¯¢é—®ä»¥ä¿æŒæ•°æ®æ–°é²œåº¦ã€‚

### Q8: åˆ‡æ¢è¯­è¨€åé—®é¢˜ä¼šå˜å—ï¼Ÿ
**A**: é—®é¢˜å†…å®¹ä¸å˜ï¼Œä½†æ–‡æœ¬ä¼šåˆ‡æ¢ä¸ºå¯¹åº”è¯­è¨€ã€‚ä¾‹å¦‚ï¼Œä¸­æ–‡"æ˜¨æ™šç¡å¾—æ€ä¹ˆæ ·ï¼Ÿ"ä¼šå˜æˆè‹±æ–‡"How did you sleep last night?"

### Q9: å¦‚ä½•çŸ¥é“æˆ‘çš„å›ç­”è¢«æ­£ç¡®è®°å½•äº†ï¼Ÿ
**A**: æäº¤æˆåŠŸåä¼šæ˜¾ç¤º"æ„Ÿè°¢ä½ çš„å›ç­”ï¼"æ¶ˆæ¯ï¼Œå¹¶ä¸”Bannerä¼šåœ¨2ç§’åæ¶ˆå¤±ã€‚ä½ å¯ä»¥åœ¨è®¾ç½®é¡µé¢æŸ¥çœ‹ä½ çš„å¥åº·æ•°æ®ã€‚

### Q10: é—®è¯¢ç³»ç»Ÿå’Œæ¯æ—¥æ ¡å‡†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
**A**: 
- **é—®è¯¢ç³»ç»Ÿ**: ä¸»åŠ¨è¯¢é—®ç¼ºå¤±çš„æ•°æ®ï¼Œéšæ—¶å¯èƒ½å‡ºç°
- **æ¯æ—¥æ ¡å‡†**: å›ºå®šçš„æ¯æ—¥é—®å·ï¼ŒåŒ…å«æ›´å…¨é¢çš„å¥åº·è¯„ä¼°

ä¸¤è€…äº’è¡¥ï¼Œå…±åŒæ„å»ºå®Œæ•´çš„å¥åº·æ•°æ®ç”»åƒã€‚

---

## 13. æ€»ç»“ | Summary

é—®è¯¢ç³»ç»Ÿï¼ˆInquiry Systemï¼‰æ˜¯ AntiAnxiety åº”ç”¨çš„æ ¸å¿ƒè‡ªé€‚åº”äº¤äº’æ¨¡å—ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

### æ ¸å¿ƒç‰¹æ€§ | Core Features
âœ… **æ™ºèƒ½ç”Ÿæˆ**: åŸºäºæ•°æ®ç¼ºå£åŠ¨æ€ç”Ÿæˆé—®é¢˜ï¼Œè€Œéé¢„è®¾æ¨¡æ¿  
âœ… **ä¼˜å…ˆçº§æ’åº**: ä¼˜å…ˆè¯¢é—®æœ€é‡è¦çš„å¥åº·æŒ‡æ ‡ï¼ˆç¡çœ ã€å‹åŠ›ï¼‰  
âœ… **æ•°æ®é—­ç¯**: å›ç­”åŒæ­¥åˆ°å¤šä¸ªç³»ç»Ÿï¼ˆæ ¡å‡†ã€AIã€æ¨èï¼‰  
âœ… **è‡ªé€‚åº”æ¨è**: AIå’Œå†…å®¹æ¨èéƒ½ä¼šæ ¹æ®é—®è¯¢ç»“æœè°ƒæ•´ç­–ç•¥  
âœ… **å¤šè¯­è¨€æ”¯æŒ**: é—®é¢˜å’Œé€‰é¡¹æ”¯æŒä¸­è‹±æ–‡å®æ—¶åˆ‡æ¢  
âœ… **æ—¶é—´ä¼˜åŒ–**: ç³»ç»Ÿå­¦ä¹ ç”¨æˆ·æ´»è·ƒæ—¶é—´ï¼Œåœ¨æœ€ä½³æ—¶æœºè¯¢é—®  

### æŠ€æœ¯äº®ç‚¹ | Technical Highlights
ğŸ”§ **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„èŒè´£åˆ†ç¦»ï¼ˆå¼•æ“ã€ä¸Šä¸‹æ–‡ã€APIã€UIï¼‰  
ğŸ”§ **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰  
ğŸ”§ **é”™è¯¯å¤„ç†**: ä¼˜é›…çš„é™çº§å’Œé‡è¯•æœºåˆ¶  
ğŸ”§ **æ€§èƒ½ä¼˜åŒ–**: å¿«é€Ÿå“åº”ï¼ˆ<500msï¼‰å’Œé«˜æ•ˆæ•°æ®åŒæ­¥  

### ä¸šåŠ¡ä»·å€¼ | Business Value
ğŸ’¡ **æå‡æ•°æ®å®Œæ•´æ€§**: ä¸»åŠ¨å¡«è¡¥æ•°æ®ç¼ºå£  
ğŸ’¡ **å¢å¼ºç”¨æˆ·ç²˜æ€§**: ä¸ªæ€§åŒ–çš„ä¸»åŠ¨å…³æ€€  
ğŸ’¡ **æ”¹å–„AIæ•ˆæœ**: æ›´å‡†ç¡®çš„å¥åº·æ´å¯Ÿ  
ğŸ’¡ **ä¼˜åŒ–å†…å®¹æ¨è**: æ›´ç²¾å‡†çš„ä¸ªæ€§åŒ–æ¨è  

---

## é™„å½• | Appendix

### A. ç›¸å…³æ–‡æ¡£ | Related Documents
- `requirements.md` - ç³»ç»Ÿéœ€æ±‚æ–‡æ¡£
- `design.md` - ç³»ç»Ÿè®¾è®¡æ–‡æ¡£
- `tasks.md` - å®ç°ä»»åŠ¡æ¸…å•
- `INQUIRY_SYSTEM_INTEGRATION.md` - é›†æˆè¯´æ˜æ–‡æ¡£

### B. æ•°æ®åº“Schema | Database Schema
å‚è€ƒ `design.md` ä¸­çš„ Database Schema Updates éƒ¨åˆ†

### C. APIæ–‡æ¡£ | API Documentation
- `GET /api/inquiry/pending?language={zh|en}` - è·å–å¾…å›ç­”é—®é¢˜
- `POST /api/inquiry/respond` - æäº¤ç”¨æˆ·å›ç­”

### D. æ›´æ–°æ—¥å¿— | Changelog
- **2024-12-23**: å®Œæˆé—®è¯¢ç³»ç»Ÿå®Œæ•´é›†æˆ
  - âœ… æ•°æ®åŒæ­¥åˆ° daily_calibrations
  - âœ… AIå¯¹è¯é›†æˆ inquiry-context
  - âœ… å†…å®¹æ¨èé›†æˆ inquiry insights
  - âœ… å¤šè¯­è¨€æ”¯æŒ
  - âœ… å®Œæ•´æ–‡æ¡£ç¼–å†™

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024-12-23  
**ç»´æŠ¤è€…**: AntiAnxiety Development Team
