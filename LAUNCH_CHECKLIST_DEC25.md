# 🚀 AntiAnxiety - 12月25日上线检查清单

**创建日期**: 2025-12-07  
**最后更新**: 2025-12-15  
**目标上线日期**: 2025-12-25  
**剩余天数**: 10天

---

## 📊 整体进度概览

### 🎯 上线倒计时

```
距离上线: ██████████░░░░░░░░░░░░░░░ 10 天
          2025-12-15 ─────────→ 2025-12-25
```

### 🌐 Web 端进度: 80%
```
████████████████████░░░░░
```

### 📱 Android 端进度: 50%
```
████████████░░░░░░░░░░░░░
```

---

## 📊 系统检查结果总结

### ✅ 已完成的核心功能

| 模块 | 状态 | 说明 |
|------|------|------|
| **AI 记忆系统 (pgvector)** | ✅ 已完成 | `ai_memory` 表 + HNSW 向量索引 + RLS 策略 |
| **Semantic Scholar 集成** | ✅ 已完成 | 双源搜索 + 重试机制 + 20秒超时 |
| **PubMed 集成** | ✅ 已完成 | E-utilities API + 并行搜索 |
| **向量知识库** | ✅ 已完成 | `metabolic_knowledge_base` + IVFFlat 索引 |
| **AI 聊天 API** | ✅ 已完成 | 上下文注入 + 人格系统 + 科学搜索 |
| **AI 问诊系统** | ✅ 已完成 | 动态问诊 + PDF 报告 + 红旗协议 |
| **贝叶斯引擎** | ✅ 已完成 | 信念循环 + 认知天平 + Max 人格 |
| **深色模式** | ✅ 已完成 | 18+ 页面全面支持 |
| **多语言支持** | ✅ 已完成 | 中/英/繁体中文 + 语言切换器 |
| **限流中间件** | ✅ 已完成 | middleware.ts + lib/rate-limiter.ts |
| **安卓项目结构** | ✅ 已完成 | Capacitor 配置 + 品牌色 + 启动画面 |

### ⚠️ 需要验证/完善的功能

| 模块 | 状态 | 待办事项 |
|------|------|----------|
| **安卓真机测试** | ⏳ 待开始 | 参考 `android/ANDROID_TEST_GUIDE.md` |
| **Cloudflare 部署** | ⏳ 未配置 | 需要配置 DNS 和 SSL |
| **Supabase 生产环境** | ⏳ 未配置 | 需要迁移生产数据库 |
| **端到端测试** | ⏳ 待开始 | 验证完整用户流程 |

---

## 💰 预算分析（月预算 ≤ 200元 ≈ $28）

### 当前架构成本估算

| 服务 | 免费层 | 预估用量 | 月成本 |
|------|--------|----------|--------|
| **Supabase** | 500MB DB, 2GB 带宽 | 1000用户 | $0 (免费层足够) |
| **Vercel** | 100GB 带宽 | 静态资源 | $0 |
| **Cloudflare Pages** | 无限请求 | CDN | $0 |
| **OpenAI API** | 无免费层 | Embedding + 关键词 | ~$10-15/月 |
| **Claude API** | 无免费层 | AI 对话 | ~$10-15/月 |
| **Semantic Scholar** | 免费 | 论文搜索 | $0 |
| **PubMed** | 免费 | 论文搜索 | $0 |
| **总计** | - | - | **~$20-30/月 ≈ ¥145-220** |

### 💡 成本优化建议

1. **AI 调用限流**：每用户每天限制 20 次 AI 对话
2. **缓存策略**：常见问题预生成回答，存入 `knowledge_base`
3. **Embedding 复用**：相似问题复用已有向量
4. **免费 API 优先**：Semantic Scholar + PubMed 无限制

---

## 🔥 1000 用户并发压力分析

### 瓶颈点分析

| 组件 | 并发能力 | 风险等级 | 解决方案 |
|------|----------|----------|----------|
| **Supabase 连接池** | 默认 15 连接 | 🔴 高 | 使用连接池 + 读写分离 |
| **AI API 调用** | 取决于 API 限制 | 🔴 高 | 队列系统 + 限流 |
| **Semantic Scholar** | 100 req/5min | 🟡 中 | 已有重试机制 |
| **PubMed** | 3 req/sec | 🟡 中 | 已有重试机制 |
| **Vercel Edge** | 无限制 | 🟢 低 | 静态资源 OK |
| **pgvector 搜索** | 取决于数据量 | 🟡 中 | 已有 HNSW 索引 |

### 预估并发场景

```
1000 活跃用户/天
├── 同时在线峰值: ~100-150 用户
├── AI 对话并发: ~20-30 请求/分钟
├── 论文搜索并发: ~10-15 请求/分钟
└── 数据库查询: ~50-100 请求/分钟
```

### 🛡️ 已实现的保护措施

1. **API 限流中间件** ✅ 已实现
```typescript
// middleware.ts + lib/rate-limiter.ts
const RATE_LIMITS = {
  chat: { max: 20, windowMs: 24 * 60 * 60 * 1000 }, // 每天 20 次
  ai: { max: 50, windowMs: 60 * 60 * 1000 },        // 每小时 50 次
  api: { max: 60, windowMs: 60 * 1000 },            // 每分钟 60 次
};
```
- 基于用户 ID 或 IP 地址的限流
- 返回标准 429 响应 + `X-RateLimit-*` 响应头
- 自动清理过期记录

2. **队列系统**（可选，上线后根据需要添加）
- 使用 Vercel KV 或 Upstash Redis 实现简单队列
- AI 请求排队处理，避免突发流量

3. **降级方案**
- 高峰期显示"系统繁忙，请稍后再试"
- 使用缓存的预生成回答

---

## 📱 安卓测试计划

### 目标测试机型

**中国市场主流机型：**
- 小米 14 / Redmi Note 13
- OPPO Reno 11
- vivo X100
- 华为 Mate 60 (鸿蒙兼容性)
- 荣耀 Magic 6

**美国市场主流机型：**
- Samsung Galaxy S24
- Google Pixel 8
- OnePlus 12

### 测试清单

- [ ] **基础功能**
  - [ ] 登录/注册流程
  - [ ] OAuth 回调 (GitHub/X)
  - [ ] 页面导航
  - [ ] 语言切换

- [ ] **AI 功能**
  - [ ] AI 对话响应
  - [ ] 论文搜索显示
  - [ ] 上下文记忆

- [ ] **性能指标**
  - [ ] 首屏加载 < 3秒
  - [ ] AI 响应 < 10秒
  - [ ] 页面切换流畅

- [ ] **兼容性**
  - [ ] Android 10+
  - [ ] 不同屏幕尺寸
  - [ ] 深色模式
  - [ ] 横屏/竖屏

---

## 📅 10天冲刺计划 (更新于 2025-12-15)

### ✅ 第1周 (12/7-12/13): 核心功能完善 - 已完成

| 日期 | 任务 | 优先级 | 状态 |
|------|------|--------|------|
| 12/7-8 | AI 记忆写入流程实现 | P0 | ✅ 已完成 |
| 12/8 | AI 问诊系统重大优化 | P0 | ✅ 已完成 |
| 12/8 | AI SDK 兼容性修复 | P0 | ✅ 已完成 |
| 12/8 | PDF 报告模板重设计 | P1 | ✅ 已完成 |
| 12/9-10 | 记忆搜索集成到聊天 | P0 | ✅ 已完成 |
| 12/11-12 | 限流中间件实现 | P1 | ✅ 已完成 |
| 12/13 | 内部功能测试 | P0 | ⏳ 部分完成 |

### 🔄 第2周 (12/14-12/20): 稳定性和移动端 - 进行中

| 日期 | 任务 | 优先级 | 状态 |
|------|------|--------|------|
| 12/14-15 | 安卓端构建和测试 | P0 | 🔄 今日任务 |
| 12/16-17 | 性能优化 + Bug 修复 | P1 | ⏳ 待开始 |
| 12/18-19 | Supabase 生产环境配置 | P0 | ⏳ 待开始 |
| 12/20 | Staging 环境部署 | P0 | ⏳ 待开始 |

### ⏳ 第3周 (12/21-12/25): 上线准备

| 日期 | 任务 | 优先级 | 状态 |
|------|------|--------|------|
| 12/21 | Cloudflare DNS 配置 | P0 | ⏳ 待开始 |
| 12/22 | SSL 证书 + 安全检查 | P0 | ⏳ 待开始 |
| 12/23 | 最终测试 + 数据备份 | P0 | ⏳ 待开始 |
| 12/24 | 软上线 + 监控 | P0 | ⏳ 待开始 |
| 12/25 | 🎄 正式上线 + 推广启动 | P0 | ⏳ 待开始 |

---

## 📣 推广计划 (12/25 启动)

### 目标平台

| 平台 | 目标受众 | 内容策略 |
|------|----------|----------|
| **Reddit** | r/Anxiety, r/HealthAnxiety, r/biohacking | 英文长文 + 产品介绍 |
| **X (Twitter)** | 健康科技爱好者 | 短视频 + 功能演示 |
| **小红书** | 中国年轻用户 | 图文笔记 + 使用体验 |

### 推广内容准备

- [ ] **产品介绍视频** (30秒)
- [ ] **功能演示 GIF** (AI 对话、论文搜索)
- [ ] **用户故事文案** (中英文)
- [ ] **Landing Page 优化**

### 首周推广节奏

```
12/25 (圣诞节): 
  - Reddit: r/Anxiety 发帖
  - X: 产品发布推文
  
12/26-27:
  - 小红书: 首篇笔记
  - X: 功能演示视频
  
12/28-31:
  - 收集用户反馈
  - 快速迭代修复
```

---

## ⚠️ 风险清单

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| AI API 超支 | 中 | 高 | 限流 + 预算告警 |
| 并发崩溃 | 低 | 高 | 降级方案 + 队列 |
| 安卓兼容问题 | 中 | 中 | 提前测试 + 快速修复 |
| 论文搜索失败 | 低 | 低 | 已有后备方案 |
| 用户增长过快 | 低 | 中 | 邀请制 + 分批开放 |

---

## ✅ 每日检查项

### 开发阶段 (12/7-12/23)
- [ ] 代码提交到 GitHub
- [ ] 更新 DEVELOPMENT_DIARY.md
- [ ] 测试关键功能
- [ ] 检查 API 调用量

### 上线阶段 (12/24-12/25)
- [ ] 数据库备份
- [ ] 监控告警配置
- [ ] 错误日志检查
- [ ] 用户反馈收集

---

## 📞 紧急联系

- **Supabase 状态**: https://status.supabase.com
- **Vercel 状态**: https://www.vercel-status.com
- **Cloudflare 状态**: https://www.cloudflarestatus.com

---

## 📋 未完成任务清单 (按优先级排序)

### 🔴 P0 - 必须完成 (上线阻塞项)

#### 📱 Android 端
- [ ] **安卓 Debug APK 构建** - 在 Android Studio 中运行 Build > Build APK
- [ ] **安卓真机测试** - 参考 `android/ANDROID_TEST_GUIDE.md`
  - [ ] 登录/注册流程
  - [ ] OAuth 回调 (GitHub/X)
  - [ ] AI 对话响应
  - [ ] 页面导航和语言切换
  - [ ] 深色模式
- [ ] **签名密钥配置** - 生成 keystore 用于 Release 构建
- [ ] **Release APK/AAB 构建** - 参考 `android/ANDROID_BUILD_GUIDE.md`

#### 🌐 部署配置
- [ ] **Cloudflare DNS 配置** - 将域名指向 Vercel
- [ ] **SSL 证书配置** - 确保 HTTPS 正常
- [ ] **Supabase 生产环境** - 迁移生产数据库配置
- [ ] **环境变量检查** - 生产环境 API Keys 配置

#### 🔧 数据库
- [x] **执行 SQL** - 添加 `current_question_text` 字段到 assessment_sessions 表 ✅ 2025-12-15

### 🟡 P1 - 重要 (影响体验)

#### 🧪 测试
- [x] **内部功能测试** - 全流程端到端测试 ✅ 2025-12-15 (HTTP 200 验证)
- [ ] **性能优化** - 首屏加载 < 3秒，AI 响应 < 10秒
- [x] **Bug 修复** - 修复测试失败问题 ✅ 2025-12-15
- [x] **362 测试用例复查** - 所有测试通过 ✅ 2025-12-15

#### 📱 Android 原生功能 (可选)
- [ ] **Health Connect 集成** - 读取健康数据
- [ ] **桌面小部件** - Glance 小部件实现
- [ ] **隐私合规弹窗** - 中国市场合规

### 🟢 P2 - 推广准备

#### 📣 营销素材
- [ ] **产品介绍视频** (30秒)
- [ ] **功能演示 GIF** (AI 对话、论文搜索)
- [ ] **用户故事文案** (中英文)
- [ ] **Landing Page 优化**

#### 📝 文档
- [ ] **用户使用指南** - 新用户引导文档
- [ ] **API 文档** - 供开发者参考

---

## ✅ 已完成任务汇总

### 12/7-12/13 第一周成果
1. ~~实现 AI 记忆写入流程~~ ✅
2. ~~配置限流中间件~~ ✅
3. ~~安卓端重建~~ ✅ (干净的 Capacitor 项目)
4. ~~安卓端配置完善~~ ✅ (启动画面、环境配置、测试文档)
5. ~~AI 问诊系统优化~~ ✅ (SDK 兼容性、重复问题修复、PDF 模板)
6. ~~AI SDK 降级修复~~ ✅ (中转站 API 兼容)
7. ~~深色模式全面支持~~ ✅ (18+ 页面)
8. ~~贝叶斯引擎完成~~ ✅ (信念循环、认知天平、Max 人格)
9. ~~PDF 报告重设计~~ ✅ (A4 单页专业医疗风格)

### 12/15 第二周进展
10. ~~执行 SQL 迁移~~ ✅ (current_question_text 字段)
11. ~~测试修复~~ ✅ (362/362 测试全通过)
12. ~~内部功能验证~~ ✅ (登录、Landing、贝叶斯页面 HTTP 200)
13. ~~进度文档更新~~ ✅ (DEVELOPMENT_DIARY + LAUNCH_CHECKLIST)
14. ~~开发环境排查~~ ✅ (IDE shell 启动失败：默认 shell / 终端 Profile 配置检查)

---

**负责人**: [待填写]  
**最后更新**: 2025-12-15 (内部测试完成，测试修复，文档更新，开发环境排查)
