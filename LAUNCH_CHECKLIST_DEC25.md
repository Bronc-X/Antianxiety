# 🚀 No More Anxious - 12月25日上线检查清单

**创建日期**: 2025-12-07  
**最后更新**: 2025-12-08  
**目标上线日期**: 2025-12-25  
**剩余天数**: 17天

---

## 📊 系统检查结果总结

### ✅ 已完成的核心功能

| 模块 | 状态 | 说明 |
|------|------|------|
| **AI 记忆系统 (pgvector)** | ✅ 已创建 | `ai_memory` 表 + HNSW 向量索引 + RLS 策略 |
| **Semantic Scholar 集成** | ✅ 已完成 | 双源搜索 + 重试机制 + 20秒超时 |
| **PubMed 集成** | ✅ 已完成 | E-utilities API + 并行搜索 |
| **向量知识库** | ✅ 已创建 | `metabolic_knowledge_base` + IVFFlat 索引 |
| **AI 聊天 API** | ✅ 已完成 | 上下文注入 + 人格系统 + 科学搜索 |
| **安卓项目结构** | ✅ 已创建 | Capacitor 配置完成 |
| **繁体中文支持** | ✅ 已完成 | 语言切换器 + 翻译回退机制 |

### ⚠️ 需要验证/完善的功能

| 模块 | 状态 | 待办事项 |
|------|------|----------|
| **AI 记忆搜索函数** | ✅ 已实现 | `match_ai_memories` RPC + 备用方案已集成 |
| **记忆写入流程** | ✅ 已实现 | 聊天后自动存储到 ai_memory (onFinish 回调) |
| **限流中间件** | ✅ 已实现 | middleware.ts + lib/rate-limiter.ts |
| **安卓端配置** | ✅ 已完成 | 配置完善、测试文档已创建，待真机测试 |
| **Cloudflare 部署** | ⚠️ 未配置 | 需要配置 DNS 和 SSL |

---

## 💰 预算分析（月预算 ≤ 200元 ≈ $28）

### 当前架构成本估算

| 服务 | 免费层 | 预估用量 | 月成本 |
|------|--------|----------|--------|
| **Supabase** | 500MB DB, 2GB 带宽 | 1000用户 | $0 (免费层足够) |
| **Vercel** | 100GB 带宽 | 静态资源 | $0 |
| **Cloudflare Pages** | 无限请求 | CDN | $0 |
| **OpenAI API** | 无免费层 | Embedding + 关键词 | ~$10-15/月 |
| **Claude API** | 无免费层 | AI 对话 | ~$10-15/月 |
| **Semantic Scholar** | 免费 | 论文搜索 | $0 |
| **PubMed** | 免费 | 论文搜索 | $0 |
| **总计** | - | - | **~$20-30/月 ≈ ¥145-220** |

### 💡 成本优化建议

1. **AI 调用限流**：每用户每天限制 20 次 AI 对话
2. **缓存策略**：常见问题预生成回答，存入 `knowledge_base`
3. **Embedding 复用**：相似问题复用已有向量
4. **免费 API 优先**：Semantic Scholar + PubMed 无限制

---

## 🔥 1000 用户并发压力分析

### 瓶颈点分析

| 组件 | 并发能力 | 风险等级 | 解决方案 |
|------|----------|----------|----------|
| **Supabase 连接池** | 默认 15 连接 | 🔴 高 | 使用连接池 + 读写分离 |
| **AI API 调用** | 取决于 API 限制 | 🔴 高 | 队列系统 + 限流 |
| **Semantic Scholar** | 100 req/5min | 🟡 中 | 已有重试机制 |
| **PubMed** | 3 req/sec | 🟡 中 | 已有重试机制 |
| **Vercel Edge** | 无限制 | 🟢 低 | 静态资源 OK |
| **pgvector 搜索** | 取决于数据量 | 🟡 中 | 已有 HNSW 索引 |

### 预估并发场景

```
1000 活跃用户/天
├── 同时在线峰值: ~100-150 用户
├── AI 对话并发: ~20-30 请求/分钟
├── 论文搜索并发: ~10-15 请求/分钟
└── 数据库查询: ~50-100 请求/分钟
```

### 🛡️ 已实现的保护措施

1. **API 限流中间件** ✅ 已实现
```typescript
// middleware.ts + lib/rate-limiter.ts
const RATE_LIMITS = {
  chat: { max: 20, windowMs: 24 * 60 * 60 * 1000 }, // 每天 20 次
  ai: { max: 50, windowMs: 60 * 60 * 1000 },        // 每小时 50 次
  api: { max: 60, windowMs: 60 * 1000 },            // 每分钟 60 次
};
```
- 基于用户 ID 或 IP 地址的限流
- 返回标准 429 响应 + `X-RateLimit-*` 响应头
- 自动清理过期记录

2. **队列系统**（可选，上线后根据需要添加）
- 使用 Vercel KV 或 Upstash Redis 实现简单队列
- AI 请求排队处理，避免突发流量

3. **降级方案**
- 高峰期显示"系统繁忙，请稍后再试"
- 使用缓存的预生成回答

---

## 📱 安卓测试计划

### 目标测试机型

**中国市场主流机型：**
- 小米 14 / Redmi Note 13
- OPPO Reno 11
- vivo X100
- 华为 Mate 60 (鸿蒙兼容性)
- 荣耀 Magic 6

**美国市场主流机型：**
- Samsung Galaxy S24
- Google Pixel 8
- OnePlus 12

### 测试清单

- [ ] **基础功能**
  - [ ] 登录/注册流程
  - [ ] OAuth 回调 (GitHub/X)
  - [ ] 页面导航
  - [ ] 语言切换

- [ ] **AI 功能**
  - [ ] AI 对话响应
  - [ ] 论文搜索显示
  - [ ] 上下文记忆

- [ ] **性能指标**
  - [ ] 首屏加载 < 3秒
  - [ ] AI 响应 < 10秒
  - [ ] 页面切换流畅

- [ ] **兼容性**
  - [ ] Android 10+
  - [ ] 不同屏幕尺寸
  - [ ] 深色模式
  - [ ] 横屏/竖屏

---

## 📅 18天冲刺计划

### 第1周 (12/7-12/13): 核心功能完善

| 日期 | 任务 | 优先级 | 状态 |
|------|------|--------|------|
| 12/7-8 | AI 记忆写入流程实现 | P0 | ✅ 已完成 |
| 12/8 | AI 问诊系统重大优化 | P0 | ✅ 已完成 |
| 12/8 | AI SDK 兼容性修复 | P0 | ✅ 已完成 |
| 12/8 | PDF 报告模板重设计 | P1 | ✅ 已完成 |
| 12/9-10 | 记忆搜索集成到聊天 | P0 | ✅ 已完成 |
| 12/11-12 | 限流中间件实现 | P1 | ✅ 已完成 |
| 12/13 | 内部功能测试 | P0 | ⏳ 待开始 |

### 第2周 (12/14-12/20): 稳定性和移动端

| 日期 | 任务 | 优先级 |
|------|------|--------|
| 12/14-15 | 安卓端构建和测试 | P0 |
| 12/16-17 | 性能优化 + Bug 修复 | P1 |
| 12/18-19 | Supabase 生产环境配置 | P0 |
| 12/20 | Staging 环境部署 | P0 |

### 第3周 (12/21-12/25): 上线准备

| 日期 | 任务 | 优先级 |
|------|------|--------|
| 12/21 | Cloudflare DNS 配置 | P0 |
| 12/22 | SSL 证书 + 安全检查 | P0 |
| 12/23 | 最终测试 + 数据备份 | P0 |
| 12/24 | 软上线 + 监控 | P0 |
| 12/25 | 🎄 正式上线 + 推广启动 | P0 |

---

## 📣 推广计划 (12/25 启动)

### 目标平台

| 平台 | 目标受众 | 内容策略 |
|------|----------|----------|
| **Reddit** | r/Anxiety, r/HealthAnxiety, r/biohacking | 英文长文 + 产品介绍 |
| **X (Twitter)** | 健康科技爱好者 | 短视频 + 功能演示 |
| **小红书** | 中国年轻用户 | 图文笔记 + 使用体验 |

### 推广内容准备

- [ ] **产品介绍视频** (30秒)
- [ ] **功能演示 GIF** (AI 对话、论文搜索)
- [ ] **用户故事文案** (中英文)
- [ ] **Landing Page 优化**

### 首周推广节奏

```
12/25 (圣诞节): 
  - Reddit: r/Anxiety 发帖
  - X: 产品发布推文
  
12/26-27:
  - 小红书: 首篇笔记
  - X: 功能演示视频
  
12/28-31:
  - 收集用户反馈
  - 快速迭代修复
```

---

## ⚠️ 风险清单

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| AI API 超支 | 中 | 高 | 限流 + 预算告警 |
| 并发崩溃 | 低 | 高 | 降级方案 + 队列 |
| 安卓兼容问题 | 中 | 中 | 提前测试 + 快速修复 |
| 论文搜索失败 | 低 | 低 | 已有后备方案 |
| 用户增长过快 | 低 | 中 | 邀请制 + 分批开放 |

---

## ✅ 每日检查项

### 开发阶段 (12/7-12/23)
- [ ] 代码提交到 GitHub
- [ ] 更新 DEVELOPMENT_DIARY.md
- [ ] 测试关键功能
- [ ] 检查 API 调用量

### 上线阶段 (12/24-12/25)
- [ ] 数据库备份
- [ ] 监控告警配置
- [ ] 错误日志检查
- [ ] 用户反馈收集

---

## 📞 紧急联系

- **Supabase 状态**: https://status.supabase.com
- **Vercel 状态**: https://www.vercel-status.com
- **Cloudflare 状态**: https://www.cloudflarestatus.com

---

**下一步行动**: 
1. ~~实现 AI 记忆写入流程~~ ✅ 已完成
2. ~~配置限流中间件~~ ✅ 已完成
3. ~~安卓端重建~~ ✅ 已完成 (干净的 Capacitor 项目)
4. ~~安卓端配置完善~~ ✅ 已完成 (启动画面、环境配置、测试文档)
5. ~~AI 问诊系统优化~~ ✅ 已完成 (SDK 兼容性、重复问题修复、PDF 模板)
6. 执行 SQL 添加 `current_question_text` 字段 ⏳ 待执行
7. 安卓真机测试 ⏳ 待开始 (参考 `android/ANDROID_TEST_GUIDE.md`)
8. 内部功能测试 ⏳ 待开始

**负责人**: [待填写]  
**最后更新**: 2025-12-08 (AI 问诊系统重大优化，PDF 模板重设计)
