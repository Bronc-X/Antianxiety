#!/usr/bin/env bash
set -euo pipefail

if [[ "${IOS_HOOK_SKIP:-}" == "1" ]]; then
  echo "â­ï¸  è·³è¿‡ iOS pre-push hook (IOS_HOOK_SKIP=1)"
  exit 0
fi

if [[ "$(uname -s)" != "Darwin" ]]; then
  echo "â­ï¸  é macOSï¼Œè·³è¿‡ iOS pre-push hook"
  exit 0
fi

IOS_TEST="${IOS_TEST:-$HOME/.codex/skills/iostest/iostest.sh}"
HOOK_LOG="${HOOK_LOG:-/tmp/iostest_pre_push.log}"

if [[ ! -x "$IOS_TEST" ]]; then
  echo "âŒ æœªæ‰¾åˆ° iostest: $IOS_TEST"
  echo "   å…ˆè¿è¡Œ /iostest æˆ–ç¡®ä¿è„šæœ¬å­˜åœ¨å¹¶å¯æ‰§è¡Œ"
  exit 1
fi

echo "ğŸš€ pre-push: è¿è¡Œ iostest (scheme=${SCHEME:-AntiAnxietynew})"
LOG_FILE="$HOOK_LOG" "$IOS_TEST"

echo "âœ… iostest é€šè¿‡ï¼Œå…è®¸æ¨é€"
